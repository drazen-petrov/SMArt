

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>SMArt.md.gromacs.io.incl &mdash; SMArt v1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> SMArt
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">SMArt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Tutorial/index.html">Tutorial</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">SMArt</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../md.html">SMArt.md</a> &raquo;</li>
        
      <li>SMArt.md.gromacs.io.incl</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for SMArt.md.gromacs.io.incl</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">SMArt.incl</span> <span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">do_warn</span>
<span class="kn">from</span> <span class="nn">SMArt.incl</span> <span class="kn">import</span> <span class="n">Defaults</span><span class="p">,</span> <span class="n">GeneralContainer</span><span class="p">,</span> <span class="n">FileStream</span><span class="p">,</span> <span class="n">StringStream</span><span class="p">,</span> <span class="n">split_gen</span><span class="p">,</span> <span class="n">get_id_string</span>
<span class="kn">from</span> <span class="nn">SMArt.md.incl</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#from SMArt.md.incl import _gr_title_gm_system, _file_type_ext_map, _add_DescriptionPart</span>
<span class="kn">from</span> <span class="nn">.gm_io_defaults</span> <span class="kn">import</span> <span class="n">gm_io_Defaults</span><span class="p">,</span> <span class="n">gm_FDs_Defaults</span><span class="p">,</span> <span class="n">gm_FF_Defaults</span>
<span class="kn">from</span> <span class="nn">.additional_classes</span> <span class="kn">import</span> <span class="n">Define</span><span class="p">,</span> <span class="n">ParsedSegments</span>


<div class="viewcode-block" id="GromacsStream"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream">[docs]</a><span class="k">class</span> <span class="nc">GromacsStream</span><span class="p">(</span><span class="n">gm_FDs_Defaults</span><span class="p">,</span> <span class="n">gm_io_Defaults</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gm_path_FDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gm_eol</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gm_comm_indicators</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_comm_indicators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gm_comm_indicators</span><span class="p">()</span>

<div class="viewcode-block" id="GromacsStream.lines"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream.lines">[docs]</a>    <span class="k">def</span> <span class="nf">lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;this is implemented in GromacsFile or GromacsString&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_get_fd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;this is implemented in GromacsFile or GromacsString&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_rem_q</span><span class="p">(</span><span class="n">f_name</span><span class="p">):</span>  <span class="c1"># remove quotes</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">f_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">qs</span><span class="p">:</span>
            <span class="n">f_name</span> <span class="o">=</span> <span class="n">f_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">f_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">qs</span><span class="p">:</span>
            <span class="n">f_name</span> <span class="o">=</span> <span class="n">f_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">f_name</span>

    <span class="k">def</span> <span class="nf">_find_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="n">fd</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">f_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">temp_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">f_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">temp_path</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">temp_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;file doesn&#39;t exist: &quot;</span> <span class="o">+</span> <span class="n">temp_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span><span class="o">==</span><span class="n">f_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f_path</span>
        <span class="n">temp_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_fd</span><span class="p">(),</span> <span class="n">f_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">temp_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">temp_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_file_gm_path</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">temp_path</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;file doesn&#39;t exist: &quot;</span> <span class="o">+</span> <span class="n">f_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_open_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="n">fd</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># searches and opens a file for the file in the local folder and in FF_DB folder - returns error if not found</span>
        <span class="n">f_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_file</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GromacsFile</span><span class="p">(</span><span class="n">f_path</span><span class="p">),</span> <span class="n">fd</span><span class="p">,</span> <span class="n">file_name</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_flag_w</span><span class="p">(</span><span class="n">if_stack</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;makes an if_stack - makes sure to read nested if statements&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">if_stack</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">1</span>

<div class="viewcode-block" id="GromacsStream.read_define"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream.read_define">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read_define</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">temp_seg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>  <span class="c1"># reads difine lines - interaction types (e.g. gd_1)</span>
        <span class="n">temp_def</span> <span class="o">=</span> <span class="n">Define</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="c1">#temp_def.gm_ord = temp_seg</span>
        <span class="n">defines</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">temp_def</span></div>

<div class="viewcode-block" id="GromacsStream.read_undef"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream.read_undef">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read_undef</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">defines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
            <span class="k">del</span><span class="p">(</span><span class="n">defines</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span></div>

<div class="viewcode-block" id="GromacsStream.find_directive"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream.find_directive">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">find_directive</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">l</span> <span class="ow">and</span> <span class="s2">&quot;]&quot;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">l</span><span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">l</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">_read_lines_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defines</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">curr_stack</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="s2">&quot;generator that return line by line - connects lines that have to be connected and takes care of if statements&quot;</span>
        <span class="k">if</span> <span class="n">curr_stack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curr_stack</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">defines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">defines</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">flag_w</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">if_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">temp_l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">temp_l</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="n">temp_l</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">continue</span>
            <span class="n">line</span><span class="p">,</span> <span class="n">flag_eol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_gm_eol</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flag_eol</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">line</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">if_seg</span> <span class="ow">in</span> <span class="n">curr_stack</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">if_seg</span><span class="o">.</span><span class="n">s</span> <span class="o">+=</span> <span class="n">line</span>
            <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_kw</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include_directive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">flag_w</span><span class="p">:</span>
                        <span class="n">new_f_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rem_q</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># because it comes with &quot; &quot;</span>
                        <span class="n">gms</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_file</span><span class="p">(</span><span class="n">new_f_name</span><span class="p">)</span>
                        <span class="n">temp_seg</span> <span class="o">=</span> <span class="n">ParsedSegments</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">curr_stack</span> <span class="o">=</span> <span class="n">curr_stack</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">line</span><span class="p">,</span>
                                                  <span class="n">file_fd_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">gms</span><span class="o">.</span><span class="n">f_path</span><span class="p">))</span>
                        <span class="c1">#temp_seg.fd, temp_seg.f_name, temp_seg.f_path = fd, file_name, gms.f_path</span>
                        <span class="n">curr_stack</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_seg</span><span class="p">)</span>
                        <span class="c1">#curr_stack[3] += 1</span>
                        <span class="k">yield</span> <span class="n">temp_seg</span>
                        <span class="k">for</span> <span class="n">included_line</span> <span class="ow">in</span> <span class="n">gms</span><span class="o">.</span><span class="n">_read_lines_generator</span><span class="p">(</span><span class="n">defines</span><span class="p">,</span> <span class="n">curr_stack</span> <span class="o">=</span> <span class="n">curr_stack</span><span class="p">):</span>
                            <span class="k">yield</span> <span class="n">included_line</span>
                        <span class="n">gms</span><span class="o">.</span><span class="n">_remove_f</span><span class="p">()</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="n">curr_stack</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">curr_stack</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#define&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">flag_w</span><span class="p">:</span>
                        <span class="n">temp_seg</span> <span class="o">=</span> <span class="n">ParsedSegments</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seg_name</span><span class="o">=</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">curr_stack</span><span class="o">=</span><span class="n">curr_stack</span><span class="p">)</span>
                        <span class="n">temp_seg</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">line</span>
                        <span class="c1">#curr_stack[3] += 1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">read_define</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">temp_seg</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="n">temp_seg</span>
                <span class="k">elif</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#undef&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">flag_w</span><span class="p">:</span>
                        <span class="n">temp_seg</span> <span class="o">=</span> <span class="n">ParsedSegments</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">curr_stack</span><span class="o">=</span><span class="n">curr_stack</span><span class="p">)</span>
                        <span class="n">temp_seg</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">line</span>
                        <span class="c1">#curr_stack[3] += 1</span>
                        <span class="k">yield</span> <span class="n">temp_seg</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">read_undef</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">defines</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#ifdef&quot;</span><span class="p">:</span>
                    <span class="n">temp_seg</span> <span class="o">=</span> <span class="n">ParsedSegments</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">curr_stack</span> <span class="o">=</span> <span class="n">curr_stack</span><span class="p">)</span>
                    <span class="n">temp_seg</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">line</span>
                    <span class="c1">#curr_stack[3] += 1</span>
                    <span class="n">curr_stack</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_seg</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">temp_seg</span>
                    <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                        <span class="n">if_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">if_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">flag_w</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#ifndef&quot;</span><span class="p">:</span>
                    <span class="n">temp_seg</span> <span class="o">=</span> <span class="n">ParsedSegments</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">curr_stack</span><span class="o">=</span><span class="n">curr_stack</span><span class="p">)</span>
                    <span class="n">temp_seg</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">line</span>
                    <span class="c1">#curr_stack[3] += 1</span>
                    <span class="n">curr_stack</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_seg</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">temp_seg</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                        <span class="n">if_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">if_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">flag_w</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#else&quot;</span><span class="p">:</span>
                    <span class="n">if_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">if_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">flag_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_w</span><span class="p">(</span><span class="n">if_stack</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#endif&quot;</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">if_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">curr_stack</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">curr_stack</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">flag_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_w</span><span class="p">(</span><span class="n">if_stack</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="k">elif</span> <span class="n">flag_w</span><span class="p">:</span>
                <span class="n">temp_directive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_directive</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp_directive</span><span class="p">:</span>
                    <span class="n">temp_seg</span> <span class="o">=</span> <span class="n">ParsedSegments</span><span class="p">(</span><span class="n">seg_type</span><span class="o">=</span><span class="s1">&#39;gm_directive&#39;</span><span class="p">,</span> <span class="n">seg_name</span><span class="o">=</span><span class="n">temp_directive</span><span class="p">,</span> <span class="n">curr_stack</span> <span class="o">=</span> <span class="n">curr_stack</span><span class="p">)</span>
                    <span class="n">temp_seg</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">line</span>
                    <span class="c1">#curr_stack[3] += 1</span>
                    <span class="n">curr_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_seg</span>
                    <span class="k">yield</span> <span class="n">temp_seg</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">line</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="GromacsStream.read_lines"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream.read_lines">[docs]</a>    <span class="k">def</span> <span class="nf">read_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defines</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">curr_stack</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">curr_stack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curr_stack</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">defines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">defines</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="c1">#        if hasattr(self, &#39;defines&#39;):</span>
<span class="c1">#            self.defines.update(defines)</span>
<span class="c1">#        else:</span>
<span class="c1">#            self.defines = defines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defines</span> <span class="o">=</span> <span class="n">defines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_lines_generator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defines</span><span class="p">,</span> <span class="n">curr_stack</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_l</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_l</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="GromacsStream.next_line"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream.next_line">[docs]</a>    <span class="k">def</span> <span class="nf">next_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_l</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_l</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="GromacsStream.write"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s2w</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s2w</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GromacsString</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">+=</span><span class="n">s2w</span></div>

<div class="viewcode-block" id="GromacsStream.write_lines"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsStream.write_lines">[docs]</a>    <span class="k">def</span> <span class="nf">write_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="n">s2w</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">l</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s2w</span><span class="o">+=</span><span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s2w</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GromacsFile"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsFile">[docs]</a><span class="k">class</span> <span class="nc">GromacsFile</span><span class="p">(</span><span class="n">FileStream</span><span class="p">,</span> <span class="n">GromacsStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;handler class for gromos files - reading / writing functions&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_get_fd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="GromacsString"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsString">[docs]</a><span class="k">class</span> <span class="nc">GromacsString</span><span class="p">(</span><span class="n">StringStream</span><span class="p">,</span> <span class="n">GromacsStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;handler class for gromos string - reading / writing functions&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_get_fd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span></div>


<span class="n">direction_interaction_map</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;bonds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BondType</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;pairs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PairType</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;pairs_nb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PairNBType</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AngleType</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DihedralType</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;impropers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImproperType</span>
<span class="c1"># this is not for reading - only for writing (see below reverse_interaction_map)</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;constraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConstraintType</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;settles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SettleType</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;virtual_sites2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VirtualSite2Type</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;virtual_sites3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VirtualSite3Type</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;virtual_sites4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VirtualSite4Type</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;virtual_sitesn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VirtualSitenType</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;position_restraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Position_r</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;distance_restraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Distance_r</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;orientation_restraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Orientation_r</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;angle_restraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Angle_r</span>
<span class="n">direction_interaction_map</span><span class="p">[</span><span class="s1">&#39;angle_restraints_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Angle_r_z</span>

<span class="n">direction_interaction_type_map</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;nonbond_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vdWType</span>
<span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;pairtypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PairType</span>
<span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;bondtypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BondType</span>
<span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;angletypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AngleType</span>
<span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;dihedraltypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DihedralType</span>
<span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;impropertypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImproperType</span>
<span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;cmaptypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>
<span class="k">for</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">direction_interaction_map</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">temp_dir</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">temp_dir</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;types&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">direction_interaction_type_map</span><span class="p">:</span>
        <span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="n">temp_dir</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">direction_interaction_map</span><span class="p">[</span><span class="n">temp_dir</span><span class="p">]</span>

<span class="n">directive_name_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;impropers&#39;</span><span class="p">:</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">,</span> <span class="s1">&#39;impropertypes&#39;</span><span class="p">:</span><span class="s1">&#39;dihedraltypes&#39;</span><span class="p">}</span>

<span class="n">ff_directives</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;defaults&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;atomtypes&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;nonbond_params&#39;</span><span class="p">,</span> <span class="s1">&#39;pairtypes&#39;</span><span class="p">]]</span>
<span class="n">ff_directives</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">direction_interaction_type_map</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ff_directives</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">ff_directives</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="c1">#top_directives = copy.deepcopy(ff_directives)</span>
<span class="c1">#top_directives.extend([[&#39;moleculetype&#39;], [&#39;system&#39;], [&#39;molecules&#39;]])</span>
<span class="n">top_directives</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;molecules&#39;</span><span class="p">]]</span>


<div class="viewcode-block" id="GromacsParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsParser">[docs]</a><span class="k">class</span> <span class="nc">GromacsParser</span><span class="p">(</span><span class="n">GeneralContainer</span><span class="p">,</span> <span class="n">Defaults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Genearal parsing functions</span>

<span class="sd">    interesting attrib</span>
<span class="sd">        gm_curr_stack - defines stack of directives, defines, IFs, etc.</span>
<span class="sd">                        self.curr_dir, self.curr_inc, self.curr_if, self.curr_seg_num</span>
<span class="sd">        _gm_curr_fnc</span>
<span class="sd">        _gm_curr_int_type</span>
<span class="sd">        undefined_directives&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gm_ff_defaults</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parse_gm_v</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">Define</span> <span class="o">=</span> <span class="n">Define</span>

<div class="viewcode-block" id="GromacsParser.add_define"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsParser.add_define">[docs]</a>    <span class="k">def</span> <span class="nf">add_define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split_line</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flag_generate_line</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">            split_line = None, line = None, flag_generate_line = True</span>
<span class="sd">            add2container kwargs</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;split_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_line</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_generate_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag_generate_line</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">Define</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__parse_from_source</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">,</span> <span class="p">(</span><span class="n">GromacsFile</span><span class="p">,</span> <span class="n">GromacsString</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">parsing_from</span>
        <span class="k">if</span> <span class="n">parse_from_file</span><span class="p">:</span>
            <span class="n">parsing_from</span> <span class="o">=</span> <span class="n">GromacsFile</span><span class="o">.</span><span class="n">_find_file_gm_path_cl</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">GromacsFile</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GromacsString</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">)</span>

<div class="viewcode-block" id="GromacsParser.exchange_defs"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsParser.exchange_defs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">exchange_defs</span><span class="p">(</span><span class="n">l_split</span><span class="p">,</span> <span class="n">defs</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l_split</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">defs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp</span></div>

    <span class="k">def</span> <span class="nf">_gm_find_parse_fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directive_name</span><span class="p">,</span> <span class="n">fnc_pref</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fnc_suf</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fnc_pref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fnc_pref</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fnc_suf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fnc_suf</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">fnc_directive_name</span> <span class="o">=</span> <span class="n">fnc_pref</span> <span class="o">+</span> <span class="n">directive_name</span> <span class="o">+</span> <span class="n">fnc_suf</span>
        <span class="k">if</span> <span class="n">fnc_directive_name</span><span class="o">!=</span><span class="n">directive_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">fnc_directive_name</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">):</span>
                <span class="n">fnc_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">fnc_directive_name</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnc_name</span><span class="p">),</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">directive_name</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">):</span>
            <span class="n">fnc_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">directive_name</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnc_name</span><span class="p">),</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignore_active_objects&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_curr_bbmol&#39;</span><span class="p">):</span>
                <span class="n">temp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_bbmol</span><span class="o">.</span><span class="n">_gm_find_parse_fnc</span><span class="p">(</span><span class="n">directive_name</span><span class="p">,</span> <span class="n">fnc_pref</span> <span class="o">=</span> <span class="n">fnc_pref</span><span class="p">,</span> <span class="n">fnc_suf</span> <span class="o">=</span> <span class="n">fnc_suf</span><span class="p">,</span>
                                                             <span class="n">allow_gm_find_parse_fnc_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp_f</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">directive_name</span> <span class="ow">in</span> <span class="n">direction_interaction_map</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_bbmol</span><span class="o">.</span><span class="n">_gm_curr_int_type</span> <span class="o">=</span> <span class="n">direction_interaction_map</span><span class="p">[</span><span class="n">directive_name</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">temp_f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curr_bbmol</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allow_gm_find_parse_fnc_not_found&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">do_warn</span><span class="p">(</span><span class="s1">&#39;unknown directive read in as text: &#39;</span> <span class="o">+</span> <span class="n">directive_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">directive_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">undefined_directives</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undefined_directives</span><span class="p">[</span><span class="n">directive_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undefined_directives</span><span class="p">[</span><span class="n">directive_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gm_curr_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_unknown_directive</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__read_unknown_directive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gm_curr_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">s</span> <span class="o">+=</span> <span class="n">l</span>

    <span class="k">def</span> <span class="nf">_add_gm_ord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># sets gm_ord - curr_dir, curr_inc, curr_if, curr_seg_num</span>
        <span class="n">temp_gm_curr_stack</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gm_curr_stack&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_gm_curr_stack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_gm_curr_stack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_curr_stack</span>
        <span class="n">item</span><span class="o">.</span><span class="n">gm_ord</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_gm_curr_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">temp_gm_curr_stack</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                       <span class="nb">tuple</span><span class="p">(</span><span class="n">temp_gm_curr_stack</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">temp_gm_curr_stack</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">__parse_gm_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsing_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;gm_curr_stack&#39;</span><span class="p">):</span>
            <span class="n">curr_stack</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gm_curr_stack&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gm_curr_stack</span> <span class="o">=</span> <span class="n">curr_stack</span>
            <span class="n">temp_seg</span> <span class="o">=</span> <span class="n">ParsedSegments</span><span class="p">(</span><span class="n">curr_stack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_curr_stack</span><span class="p">)</span>
            <span class="n">curr_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_seg</span>
            <span class="c1">#curr_stack[3] += 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_seg</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curr_stack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_curr_stack</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gm_curr_stack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">curr_stack</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;defines&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defines</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">defines</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defines&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">defines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defines</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defines</span><span class="p">)</span>
        <span class="n">defines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defines</span>
        <span class="n">gms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parse_from_source</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">)</span>
        <span class="n">temp_title</span> <span class="o">=</span> <span class="n">DescriptionPart</span><span class="p">(</span><span class="n">form</span> <span class="o">=</span> <span class="s1">&#39;gm&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">temp_title</span><span class="o">.</span><span class="n">_add_source</span><span class="p">(</span><span class="n">gms</span><span class="o">.</span><span class="n">f_path</span><span class="p">,</span> <span class="n">additional_txt</span> <span class="o">=</span> <span class="s1">&#39;GROMACS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_title</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;parsed_from&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parsed_from</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parsed_from</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gms</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;undefined_directives&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undefined_directives</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_fnc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_unknown_directive</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">gms</span><span class="o">.</span><span class="n">read_lines</span><span class="p">(</span><span class="n">defines</span> <span class="o">=</span> <span class="n">defines</span><span class="p">,</span> <span class="n">curr_stack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_curr_stack</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ParsedSegments</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_fnc</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">seg_type</span><span class="o">==</span><span class="s1">&#39;gm_directive&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">seg_name</span> <span class="ow">in</span> <span class="n">direction_interaction_map</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_int_type</span> <span class="o">=</span> <span class="n">direction_interaction_map</span><span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">seg_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">seg_name</span> <span class="ow">in</span> <span class="n">direction_interaction_type_map</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_ff_int_type</span> <span class="o">=</span> <span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">seg_name</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_fnc</span><span class="p">,</span> <span class="n">parsing_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_find_parse_fnc</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">seg_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">l</span><span class="o">.</span><span class="n">seg_type</span><span class="o">==</span><span class="s1">&#39;gm_define&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defines</span><span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">seg_name</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">l</span><span class="o">.</span><span class="n">seg_type</span> <span class="o">==</span> <span class="s1">&#39;include&#39;</span><span class="p">:</span>
                    <span class="n">temp_title</span> <span class="o">=</span> <span class="n">DescriptionPart</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;gm&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">temp_title</span><span class="o">.</span><span class="n">_add_source</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">f_path</span><span class="p">,</span> <span class="n">additional_txt</span><span class="o">=</span><span class="s1">&#39;GROMACS&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_title</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_title</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignore_title_lines&#39;</span><span class="p">):</span>
            <span class="n">seg0_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">seg0_lines</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">DescriptionPart</span><span class="o">.</span><span class="n">container2write</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">seg0_lines</span><span class="p">)</span>
        <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_fnc</span><span class="p">)</span>
        <span class="n">gms</span><span class="o">.</span><span class="n">_remove_f</span><span class="p">()</span>

<div class="viewcode-block" id="GromacsParser.parse_gm"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsParser.parse_gm">[docs]</a>    <span class="k">def</span> <span class="nf">parse_gm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        parsing gromacs format</span>
<span class="sd">        :param parse_from:</span>
<span class="sd">        :param parse_from_file:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">            gm_curr_stack</span>
<span class="sd">            defines - gromacs defines</span>
<span class="sd">            ignore_title_lines</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c1">#        temp_fd = os.getcwd()</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parse_gm_v</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>
<span class="c1">#        os.chdir(temp_fd)</span>

<span class="n">GromacsParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">({</span><span class="s1">&#39;__parse_gm_v&#39;</span><span class="p">:</span><span class="s1">&#39;__parse_gm_v1&#39;</span><span class="p">},</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="GromacsWriter"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsWriter">[docs]</a><span class="k">class</span> <span class="nc">GromacsWriter</span><span class="p">(</span><span class="n">GeneralContainer</span><span class="p">,</span> <span class="n">Defaults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Genearal writing functions&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defines</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__write_directive_line_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">directive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">directive</span> <span class="ow">in</span> <span class="n">directive_name_map</span><span class="p">:</span>
            <span class="n">directive</span> <span class="o">=</span> <span class="n">directive_name_map</span><span class="p">[</span><span class="n">directive</span><span class="p">]</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ </span><span class="si">{:}</span><span class="s1"> ]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directive</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_write_directive_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">directive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_directive_line_v</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">directive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_define_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">defs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_defines</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defines2write&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">temp_defines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_self_defines&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">self_defs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;defines&#39;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="n">self_defs</span><span class="p">:</span>
                    <span class="n">temp_defines</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">temp_defines</span><span class="p">)</span>
                    <span class="n">temp_defines</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">self_defs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_defines</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;defines&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">defs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="n">temp_defines</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="n">gs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">temp_defines</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">write_define</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gm_defs_from_seg</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_segment_order&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_define_noseg&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="k">return</span>
                <span class="n">gm_parsed_segments</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gm_parsed_segments&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_segments&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">gm_parsed_segments</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">seg</span><span class="o">.</span><span class="n">seg_type</span> <span class="o">==</span> <span class="s1">&#39;gm_define&#39;</span><span class="p">:</span>
                        <span class="n">gm_defs_from_seg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">seg_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">temp_defines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gm_defs_from_seg</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_segment_order&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">temp_defines</span><span class="p">[</span><span class="n">d</span><span class="p">],</span><span class="s1">&#39;gm_ord&#39;</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="n">temp_defines</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                        <span class="n">gs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">temp_defines</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">write_define</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_write_define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param gs:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">            defs - list of defines to write</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defs&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_define_v</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">defs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_TITLE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">flag_title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_title&#39;</span><span class="p">)</span>
        <span class="n">temp_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">temp_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">DescriptionPart</span><span class="p">,</span> <span class="n">flag_class</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_cont</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">flag_title</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">temp_cont</span> <span class="o">=</span> <span class="n">temp_cont</span><span class="p">[:</span><span class="n">flag_title</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">temp_title</span> <span class="ow">in</span> <span class="n">temp_cont</span><span class="p">:</span>
            <span class="n">temp_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">first_line</span><span class="p">)</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">temp_l</span> <span class="ow">in</span> <span class="n">temp_title</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                <span class="n">temp_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">_comm_indicators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">temp_l</span><span class="p">)</span>
        <span class="n">temp_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">write_lines</span><span class="p">(</span><span class="n">temp_lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_gm_TITLE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_TITLE_v</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">include_segment_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param gs:</span>
<span class="sd">        :param include_segment_path:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">            full_path</span>
<span class="sd">            file_name</span>
<span class="sd">            from_str</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path2write</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include_segment_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">path2write</span> <span class="o">=</span> <span class="n">include_segment_path</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_path&#39;</span><span class="p">):</span>
            <span class="n">path2write</span> <span class="o">=</span> <span class="n">include_segment_path</span><span class="o">.</span><span class="n">f_path</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_name&#39;</span><span class="p">):</span>
            <span class="n">path2write</span> <span class="o">=</span> <span class="n">include_segment_path</span><span class="o">.</span><span class="n">f_name</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from_str&#39;</span><span class="p">):</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">include_segment_path</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path2write</span> <span class="o">=</span> <span class="n">include_segment_path</span><span class="o">.</span><span class="n">f_path</span>
        <span class="k">if</span> <span class="n">path2write</span><span class="p">:</span>
            <span class="n">write_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:}</span><span class="s1"> &quot;</span><span class="si">{1:}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">_gm_kw</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path2write</span><span class="p">))</span>
            <span class="c1">#gs.write(gs._gm_kw[0] + &#39; &quot;&#39; + path2write + &#39;&quot;\n&#39;)</span>

    <span class="k">def</span> <span class="nf">_write_if</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">temp_if</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">temp_if</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

<div class="viewcode-block" id="GromacsWriter.write_gromacs_format"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.GromacsWriter.write_gromacs_format">[docs]</a>    <span class="k">def</span> <span class="nf">write_gromacs_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">directives</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flag_include</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">flag_if</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                  <span class="n">flag_defines</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">flag_title</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">directives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy_directives</span><span class="p">(</span><span class="n">directives</span><span class="p">)</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_gromacs_format_v</span><span class="p">)</span>
        <span class="n">full_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__update_kwargs4write_gromacs_format</span><span class="p">(</span><span class="n">flag_include</span> <span class="o">=</span> <span class="n">flag_include</span><span class="p">,</span> <span class="n">flag_if</span> <span class="o">=</span> <span class="n">flag_if</span><span class="p">,</span>
                                  <span class="n">flag_defines</span> <span class="o">=</span> <span class="n">flag_defines</span><span class="p">,</span> <span class="n">flag_title</span> <span class="o">=</span> <span class="n">flag_title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">directives</span> <span class="o">=</span> <span class="n">directives</span><span class="p">,</span> <span class="o">**</span><span class="n">full_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_close&#39;</span><span class="p">):</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__copy_directives</span><span class="p">(</span><span class="n">directives</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">directives</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">grp_dir</span> <span class="ow">in</span> <span class="n">directives</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">grp_dir</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grp_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">break</span>
        <span class="n">new_directives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">grp_dir</span> <span class="ow">in</span> <span class="n">directives</span><span class="p">:</span>
                <span class="n">new_directives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">grp_dir</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_directives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">directives</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_directives</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__update_kwargs4write_gromacs_format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">default_KWs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">flag_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag_include</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flag_if</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flag_defines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">flag_use_define</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">flag_ff_defines</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">temp_kw</span> <span class="ow">in</span> <span class="n">default_KWs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">temp_kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">temp_kw</span><span class="p">,</span> <span class="n">default_KWs</span><span class="p">[</span><span class="n">temp_kw</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">__set_gm_writing_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_GromacsWriter__writing_state_var&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span> <span class="o">=</span> <span class="p">[([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])]</span> <span class="c1"># gs, include, if, defines, directives</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_gm_writing_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_gm_writing_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_gs2writing_state</span><span class="p">(</span><span class="n">GromacsString</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span>

    <span class="k">def</span> <span class="nf">_add_gs2writing_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_gm_writing_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_include_gs2writing_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_include</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">GromacsFile</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gs2writing_state</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gs</span>

    <span class="k">def</span> <span class="nf">_remove_gs_from_writing_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">old_gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">old_gs</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_add_state2writing_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_gm_writing_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="n">gs</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]))</span> <span class="c1"># gs, include, if, defines, directives</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__transform_directives_sep2include_files</span><span class="p">(</span><span class="n">directives</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param directives:</span>
<span class="sd">        :param sep2include_files:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">            last_inc_file = None</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sep2include_files</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sep2include_files&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sep2include_files</span><span class="p">:</span>
            <span class="n">sep2include_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_inc_file&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="n">flag_transform</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sep2include_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">flag_transform</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">flag_transform</span><span class="p">:</span>
            <span class="n">sep2include_files_transformed</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">c_curr</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">curr_directive</span> <span class="o">=</span> <span class="n">sep2include_files</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">sep2include_files</span><span class="p">:</span>
                <span class="n">next_directive</span> <span class="o">=</span> <span class="n">sep2include_files</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">curr_directive</span> <span class="o">==</span> <span class="n">next_directive</span><span class="p">:</span>
                    <span class="n">c_curr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sep2include_files_transformed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_directive</span><span class="p">,</span> <span class="n">c_curr</span><span class="p">))</span>
                    <span class="n">c_curr</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">curr_directive</span> <span class="o">=</span> <span class="n">next_directive</span>
            <span class="n">sep2include_files_transformed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_directive</span><span class="p">,</span> <span class="n">c_curr</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">directives_transformed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sep_inc_file</span> <span class="ow">in</span> <span class="n">sep2include_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sep_inc_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">sep_inc_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_dir</span><span class="p">,</span> <span class="s1">&#39;non-consecutive usage of the same file name&#39;</span>
                <span class="n">temp_dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sep_inc_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">new_c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">sep_inc_file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">directives_transformed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sep_inc_file</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">directives</span><span class="p">[</span><span class="n">c</span><span class="p">:</span><span class="n">new_c</span><span class="p">]))</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">new_c</span>
        <span class="n">directives_transformed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_inc_file&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">directives</span><span class="p">[</span><span class="n">c</span><span class="p">:]))</span>
        <span class="k">return</span> <span class="n">directives_transformed</span>

    <span class="k">def</span> <span class="nf">__write_gromacs_format_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">directives</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param gs:</span>
<span class="sd">        :param directives: [[dir1_1, dir1_2, ...], [dir2_1, dir2_2, ...], ...] in groups</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">            flag_include</span>
<span class="sd">            flag_if</span>
<span class="sd">            flag_defines</span>
<span class="sd">            flag_use_define</span>
<span class="sd">            flag_title</span>
<span class="sd">            flag_segment_order</span>
<span class="sd">            check_self_flag_write</span>
<span class="sd">            flag_ff_defines</span>
<span class="sd">            sep2include_files = [None, None, f_path1, f_path1, None, f_path2, ...]</span>
<span class="sd">                                [(None, 2), (f_path1,2), (None, 1), (f_path2, 1), ...]</span>
<span class="sd">            last_inc_file = None</span>
<span class="sd">            flag_defines_first_include = False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">directives</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gm_writing_state&#39;</span><span class="p">,</span> <span class="p">[([</span><span class="n">gs</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])])</span>
        <span class="k">assert</span> <span class="n">gs</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;gromacs stream != from __writing_state_var defined gs&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segments_writing_stack</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gm_segments_writing_stack&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_segments&#39;</span><span class="p">,[])))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_include&#39;</span><span class="p">]:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_segment_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_segment_order&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;check_self_flag_write&#39;</span><span class="p">):</span>
            <span class="n">flag_write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_write</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="n">directives_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__transform_directives_sep2include_files</span><span class="p">(</span><span class="n">directives</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_gm_TITLE</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_defines&#39;</span><span class="p">]:</span><span class="c1">############################################################### fix to write gm defaults</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_defines_first_include&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_define</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c1">#        for temp_fpath, grp_dir in zip(sep2include_files, directives):</span>
        <span class="k">for</span> <span class="n">temp_fpath</span><span class="p">,</span> <span class="n">directives</span> <span class="ow">in</span> <span class="n">directives_transformed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">temp_fpath</span><span class="p">:</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_include_gs2writing_state</span><span class="p">(</span><span class="n">temp_fpath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_defines_first_include&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_defines&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_write_define</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_defines_first_include&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">grp_dir</span> <span class="ow">in</span> <span class="n">directives</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_segment_order&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__write_gm_order_directives</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">grp_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">grp_dir</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_segment_order&#39;</span><span class="p">):</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_check_directive_inWS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_check_directive_inWS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_write_directive</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_fpath</span><span class="p">:</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_gs_from_writing_state</span><span class="p">()</span>
<span class="c1">#                self._gm_writing_state[-1][0].pop(-1)</span>
<span class="c1">#                gs = self._gm_writing_state[-1][0][-1]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_del_writing_state&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__writing_state_var</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_gm_order_directives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">gm_grp_directives</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments_writing_stack</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">segs2remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">segs2remove_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_segments_writing_stack</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">seg</span><span class="o">.</span><span class="n">seg_type</span> <span class="o">==</span> <span class="s1">&#39;gm_directive&#39;</span> <span class="ow">and</span> <span class="n">seg</span><span class="o">.</span><span class="n">seg_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gm_grp_directives</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">segs2remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">segs2remove_map</span><span class="p">[</span><span class="n">seg</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__write_gm_order_segment</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">seg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">temp_seg</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">temp_seg</span> <span class="ow">in</span> <span class="n">segs2remove_map</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="n">segs2remove_map</span><span class="p">[</span><span class="n">temp_seg</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">temp_seg</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">temp_seg</span> <span class="ow">in</span> <span class="n">segs2remove_map</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="n">segs2remove_map</span><span class="p">[</span><span class="n">temp_seg</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">segs2remove_map</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">seg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments_writing_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">seg</span><span class="o">.</span><span class="n">seg_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;if&#39;</span><span class="p">,</span> <span class="s1">&#39;include&#39;</span><span class="p">):</span>
                <span class="n">flag_write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_write</span><span class="p">:</span><span class="k">continue</span>
                <span class="k">if</span> <span class="n">seg</span><span class="o">.</span><span class="n">seg_type</span> <span class="o">==</span> <span class="s1">&#39;if&#39;</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_if&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_if</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">flag_if_temp_gm_object</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">seg</span><span class="o">.</span><span class="n">seg_type</span> <span class="o">==</span> <span class="s1">&#39;include&#39;</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_include&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_include</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">flag_include_temp_gm_object</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_gm_order_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">gm_segment</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">gm_segment</span><span class="o">.</span><span class="n">seg_type</span> <span class="o">==</span> <span class="s1">&#39;gm_define&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_defines&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="n">gm_segment</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;def_from_segment&#39;</span><span class="p">):</span>
                        <span class="n">gs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gm_segment</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_write_define</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">defs</span> <span class="o">=</span> <span class="p">[</span><span class="n">gm_segment</span><span class="o">.</span><span class="n">seg_name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">gm_segment</span><span class="o">.</span><span class="n">seg_type</span> <span class="o">==</span> <span class="s1">&#39;gm_directive&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;curr_directive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gm_segment</span>
            <span class="c1">#self._write_directive(gs, gm_segment.seg_name, curr_directive = gm_segment, **kwargs)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_directive</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">gm_segment</span><span class="o">.</span><span class="n">seg_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gm_segment</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_directive_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">direction_interaction_type_map</span><span class="p">:</span>
            <span class="n">int_type</span> <span class="o">=</span> <span class="n">direction_interaction_type_map</span><span class="p">[</span><span class="n">temp_dir</span><span class="p">]</span>
            <span class="n">temp_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(</span><span class="n">int_type</span><span class="p">,</span> <span class="n">cont_pref</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm_cont_pref</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_cont</span><span class="p">:</span><span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_write_ff_int_type</span> <span class="o">=</span> <span class="n">int_type</span>
        <span class="k">if</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">direction_interaction_map</span><span class="p">:</span>
            <span class="n">int_type</span> <span class="o">=</span> <span class="n">direction_interaction_map</span><span class="p">[</span><span class="n">temp_dir</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_write_mol_int_type</span> <span class="o">=</span> <span class="n">int_type</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_write_gm_&#39;</span> <span class="o">+</span> <span class="n">temp_dir</span><span class="p">))</span>
        <span class="n">txt2write</span> <span class="o">=</span> <span class="n">temp_f</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">txt2write</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_directive_line</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt2write</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_directive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">directive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_directive_v</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">directive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_flag_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_include&#39;</span><span class="p">):</span>
            <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_include</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_flag</span><span class="p">:</span><span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_if&#39;</span><span class="p">):</span>
            <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_if</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_flag</span><span class="p">:</span><span class="k">return</span> <span class="kc">False</span>
<span class="c1">#        if not kwargs.get(&#39;flag_replace_define&#39;) and isinstance(temp_gm_object, Define):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="n">Define</span><span class="p">):</span>
            <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_define_inWS</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_flag</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;curr_directive&#39;</span><span class="p">):</span>
            <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_curr_directive</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_flag</span><span class="p">:</span><span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_check_directive_inWS&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="n">ParsedSegments</span><span class="p">)</span> <span class="ow">and</span> <span class="n">temp_gm_object</span><span class="o">.</span><span class="n">seg_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;gm_define&#39;</span><span class="p">,</span> <span class="s1">&#39;if&#39;</span><span class="p">)):</span>
                <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_directive_inWS</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_flag</span><span class="p">:</span><span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_check_flag_include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">incl_depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;include_depth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">temp_writing_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="n">temp_depth</span><span class="p">]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if len(temp_gm_object.gm_ord[1]) &gt; temp_depth:</span>
<span class="sd">            if temp_gm_object.gm_ord[1][temp_depth] not in temp_writing_state[1]:</span>
<span class="sd">                temp_writing_state[1].append(temp_gm_object.gm_ord[1][temp_depth])</span>
<span class="sd">                self._write_include(temp_writing_state[0], temp_gm_object.gm_ord[1][temp_depth], **kwargs)</span>
<span class="sd">            return False</span>
<span class="sd">        return True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_include_temp_gm_object&#39;</span><span class="p">):</span>
            <span class="n">temp_include</span> <span class="o">=</span> <span class="n">temp_gm_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_include</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="s1">&#39;gm_ord&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">temp_gm_object</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">temp_include</span> <span class="o">=</span> <span class="n">temp_gm_object</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">incl_depth</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">temp_include</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">temp_include</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_writing_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">temp_writing_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_include</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_include</span><span class="p">(</span><span class="n">temp_writing_state</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">temp_include</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_check_flag_if</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_if_temp_gm_object&#39;</span><span class="p">):</span>
            <span class="n">temp_if</span> <span class="o">=</span> <span class="n">temp_gm_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_if</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="s1">&#39;gm_ord&#39;</span><span class="p">)</span> <span class="ow">and</span>  <span class="n">temp_gm_object</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">temp_if</span> <span class="o">=</span> <span class="n">temp_gm_object</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">temp_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">temp_writing_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="n">temp_depth</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">temp_if</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">temp_if</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_writing_state</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">temp_writing_state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_if</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_if</span><span class="p">(</span><span class="n">temp_writing_state</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">temp_if</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_check_curr_directive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="s1">&#39;gm_ord&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;curr_directive&#39;</span><span class="p">)</span><span class="o">==</span><span class="n">temp_gm_object</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_check_directive_inWS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">,</span> <span class="s1">&#39;gm_ord&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">temp_gm_object</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="kc">False</span>
<span class="c1">#            self.__writing_state[-1][4].append(temp_gm_object.gm_ord[0])</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_check_define_inWS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_gm_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_replace_define&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">temp_gm_object</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_gm_object</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_gms_from_fpaht</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fpath</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">GromacsFile</span><span class="p">):</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="n">fpath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="n">GromacsFile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">GromacsString</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">gs</span></div>

<span class="n">_GromacsWriter_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_GromacsWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_gromacs_format_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_gromacs_format_v1&#39;</span>
<span class="n">_GromacsWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_directive_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_directive_v1&#39;</span>
<span class="n">_GromacsWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_directive_line_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_directive_line_v1&#39;</span>
<span class="n">_GromacsWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_define_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_define_v1&#39;</span>
<span class="n">_GromacsWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_TITLE_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_TITLE_v1&#39;</span>

<span class="n">GromacsWriter</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GromacsWriter_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="gmFFParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmFFParser">[docs]</a><span class="k">class</span> <span class="nc">gmFFParser</span><span class="p">(</span><span class="n">GromacsParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="s1">&#39;a_type&#39;</span><span class="p">)</span> <span class="c1"># container with atom types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_a_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="s1">&#39;b_a_type&#39;</span><span class="p">)</span> <span class="c1"># container with bond_atom types - for opls FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># from FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_gm_interaction_type_container</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># from FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b_a_atom_wildcard</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># FF</span>

<div class="viewcode-block" id="gmFFParser.parse_ff_gm"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmFFParser.parse_ff_gm">[docs]</a>    <span class="k">def</span> <span class="nf">parse_ff_gm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_gm</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="n">gm_FF_Defaults</span> <span class="o">=</span> <span class="n">gm_FF_Defaults</span>

    <span class="k">def</span> <span class="nf">__defaults_parser_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;gm_ff_defaults&#39;</span><span class="p">):</span>
            <span class="n">do_warn</span><span class="p">(</span><span class="s1">&#39;gm_ff_defaults already defined, overwriting...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gm_ff_defaults</span> <span class="o">=</span> <span class="n">gm_FF_Defaults</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gm_ff_defaults</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__atomtypes_parser_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">at_id</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">b_at_id</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b_at_id</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">temp_b_at</span> <span class="o">=</span> <span class="n">BondAtomType</span><span class="p">(</span><span class="n">b_at_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_b_at</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>
        <span class="n">temp_at</span> <span class="o">=</span> <span class="n">AtomType</span><span class="p">(</span><span class="n">at_id</span><span class="p">,</span> <span class="n">at_id</span><span class="p">,</span> <span class="n">bond_atom_id</span> <span class="o">=</span> <span class="n">b_at_id</span><span class="p">,</span> <span class="n">vdw</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])],</span>
                           <span class="n">format_type</span><span class="o">=</span><span class="s1">&#39;gm&#39;</span><span class="p">)</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">p_ch</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">p_type</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_at</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_at</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;DUM&#39;</span> <span class="ow">in</span> <span class="n">temp_at</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">DUM_type</span> <span class="o">=</span> <span class="n">temp_at</span>

    <span class="k">def</span> <span class="nf">__find_b_a_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_at_id</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">temp_at_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b_a_atom_wildcard</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b_a_atom_wildcard</span>
        <span class="n">b_a_type_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(</span><span class="n">BondAtomType</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_a_type_cont</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">temp_at_id</span> <span class="ow">in</span> <span class="n">b_a_type_cont</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">temp_at_id</span>
        <span class="n">a_type_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(</span><span class="n">AtomType</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_at_id</span> <span class="ow">in</span> <span class="n">a_type_cont</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">a_type_cont</span><span class="p">[</span><span class="n">temp_at_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">allow_not_found</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;atom type not found: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">temp_at_id</span><span class="p">))</span>

        <span class="c1">##################################### should be split in general and specific ones</span>
    <span class="k">def</span> <span class="nf">__parse_interaction_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="n">int_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">remove_defs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">int_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">int_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_ff_int_type</span>
        <span class="n">na</span> <span class="o">=</span> <span class="n">int_type</span><span class="o">.</span><span class="n">na</span>
        <span class="n">temp_l</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">temp_int_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">int_type</span><span class="o">==</span><span class="n">DihedralType</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">temp_at_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
                <span class="n">temp_int_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_b_a_type</span><span class="p">(</span><span class="n">temp_at_id</span><span class="p">)</span>
                <span class="n">temp_int_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_int_at</span><span class="p">)</span>
            <span class="n">temp_at_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
            <span class="n">temp_int_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_b_a_type</span><span class="p">(</span><span class="n">temp_at_id</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_int_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">temp_fnc</span> <span class="o">=</span> <span class="n">temp_at_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_int_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_int_at</span><span class="p">)</span>
                <span class="n">temp_at_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
                <span class="n">temp_int_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_b_a_type</span><span class="p">(</span><span class="n">temp_at_id</span><span class="p">)</span>
                <span class="n">temp_int_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_int_at</span><span class="p">)</span>
                <span class="n">temp_fnc</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">na</span><span class="p">):</span>
                <span class="n">temp_at_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
                <span class="n">temp_int_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_b_a_type</span><span class="p">(</span><span class="n">temp_at_id</span><span class="p">)</span>
                <span class="n">temp_int_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_int_at</span><span class="p">)</span>
            <span class="n">temp_fnc</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">int_type</span><span class="o">!=</span><span class="n">cmap</span><span class="p">:</span>
            <span class="n">temp_int_type</span> <span class="o">=</span> <span class="n">int_type</span><span class="p">(</span><span class="n">fnc_type</span><span class="o">=</span><span class="n">temp_fnc</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">temp_int_atoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_grid</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)))</span>
            <span class="n">temp_int_type</span> <span class="o">=</span> <span class="n">int_type</span><span class="p">(</span><span class="n">fnc_type</span><span class="o">=</span><span class="n">temp_fnc</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">temp_int_atoms</span><span class="p">,</span> <span class="n">grid_ind</span> <span class="o">=</span> <span class="n">temp_grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_gm_interaction_type_container</span><span class="p">(</span><span class="n">temp_int_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">remove_defs</span><span class="p">:</span>
            <span class="n">temp_param</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_param</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                <span class="n">temp_int_type</span><span class="o">.</span><span class="n">gmdef</span> <span class="o">=</span> <span class="n">temp_param</span>
                <span class="n">temp_int_type</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">defines</span><span class="p">[</span><span class="n">temp_param</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
                <span class="n">extra_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">extra_params</span><span class="p">:</span>
                    <span class="n">do_warn</span><span class="p">(</span><span class="s1">&#39;not able to read all parameters, rest:&#39;</span><span class="p">,</span> <span class="n">extra_params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_int_type</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">temp_param</span><span class="p">)</span>
                <span class="n">temp_int_type</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">temp_l</span><span class="p">,</span> <span class="n">flag_check_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_int_type</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange_defs</span><span class="p">(</span><span class="n">temp_l</span><span class="p">,</span> <span class="n">defines</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_int_type</span><span class="p">)</span>
<span class="c1">#        if int_type == DihedralType:</span>
<span class="c1">#            temp_int_type._gm_check_dih_imp()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_int_type</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="n">_gmFFParser_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_gmFFParser_defs</span><span class="p">[</span><span class="s1">&#39;_defaults_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__defaults_parser_v1&#39;</span>
<span class="n">_gmFFParser_defs</span><span class="p">[</span><span class="s1">&#39;_atomtypes_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__atomtypes_parser_v1&#39;</span>

<span class="k">for</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">direction_interaction_type_map</span><span class="p">:</span>
    <span class="n">temp_dir_fnc_attr</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">temp_dir</span><span class="o">+</span><span class="s1">&#39;_parser&#39;</span>
    <span class="k">if</span> <span class="n">temp_dir_fnc_attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_gmFFParser_defs</span><span class="p">:</span>
        <span class="n">_gmFFParser_defs</span><span class="p">[</span><span class="n">temp_dir_fnc_attr</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__parse_interaction_type&#39;</span>

<span class="c1">#_gmFFParser_defs[&#39;_cmaptypes_parser&#39;] = &#39;__cmaptypes_parser_v1&#39;</span>
<span class="c1">#_gmFFParser_defs[&#39;_nonbond_params_parser&#39;] = &#39;__nonbond_params_parser_v1&#39;</span>
<span class="c1">#_gmFFParser_defs[&#39;_pairtypes_parser&#39;] = &#39;__pairtypes_parser_v1&#39;</span>

<span class="n">gmFFParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_gmFFParser_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fnc_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gb&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;ga&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;gd&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;gi&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">}</span>


<div class="viewcode-block" id="gmFFWriter"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmFFWriter">[docs]</a><span class="k">class</span> <span class="nc">gmFFWriter</span><span class="p">(</span><span class="n">GromacsWriter</span><span class="p">):</span>

    <span class="n">__a_type_format1</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{:&gt;4}</span><span class="s1"> </span><span class="si">{:&gt;4}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;5}</span><span class="s1"> </span><span class="si">{:12.7e}</span><span class="s1"> </span><span class="si">{:12.7e}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">__a_type_format2</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{:&gt;9}</span><span class="s1"> </span><span class="si">{:&gt;3}</span><span class="s1"> </span><span class="si">{:&gt;3}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;5}</span><span class="s1"> </span><span class="si">{:12.7e}</span><span class="s1"> </span><span class="si">{:12.7e}</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="n">__int_type_atom_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;6}</span><span class="s1"> &#39;</span>
    <span class="n">__int_type_fnc_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;1}</span><span class="s1">&#39;</span>
    <span class="n">__int_type_p_format</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span><span class="s1">&#39; </span><span class="si">{:12s}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">:</span><span class="s1">&#39; </span><span class="si">{:12.7e}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">:</span> <span class="s1">&#39; </span><span class="si">{:12d}</span><span class="s1">&#39;</span><span class="p">}</span>
    <span class="n">__int_type_gmdef_format</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{:&gt;6}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">_write_gm_ff_defines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">defs2write</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">define</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;defines&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">define</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_FF_&#39;</span><span class="p">):</span>
                <span class="n">defs2write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">define</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_replace_define&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_define</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">defs</span> <span class="o">=</span> <span class="n">defs2write</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_gm_defaults_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_ff_defines&#39;</span><span class="p">):</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_gm_ff_defines</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">temp_txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gm_ff_defaults</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">temp_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_ff_defaults</span><span class="o">.</span><span class="n">write_defs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">temp_txt</span>

    <span class="k">def</span> <span class="nf">__write_gm_atomtypes_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">txt2write</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">a_type_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(</span><span class="n">AtomType</span><span class="p">)</span>
        <span class="n">b_a_type_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(</span><span class="n">BondAtomType</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">at_id</span> <span class="ow">in</span> <span class="n">a_type_cont</span><span class="p">:</span>
            <span class="n">temp_a_type</span> <span class="o">=</span> <span class="n">a_type_cont</span><span class="p">[</span><span class="n">at_id</span><span class="p">]</span>
            <span class="n">flag_write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="n">temp_a_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_write</span><span class="p">:</span><span class="k">continue</span>
            <span class="n">temp_v</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">temp_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">temp_a_type</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gm_id&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">b_a_type_cont</span><span class="p">:</span>
                <span class="n">temp_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_a_type</span><span class="o">.</span><span class="n">b_id</span><span class="p">)</span>
            <span class="n">temp_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_a_type</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
            <span class="n">temp_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_a_type</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
            <span class="n">temp_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_a_type</span><span class="o">.</span><span class="n">p_ch</span><span class="p">)</span>
            <span class="n">temp_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_a_type</span><span class="o">.</span><span class="n">p_type</span><span class="p">)</span>
            <span class="n">temp_v</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_a_type</span><span class="o">.</span><span class="n">vdw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b_a_type_cont</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__a_type_format2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">temp_v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__a_type_format1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">temp_v</span><span class="p">)</span>
            <span class="n">txt2write</span> <span class="o">+=</span> <span class="n">txt</span>
        <span class="k">return</span> <span class="n">txt2write</span>

    <span class="k">def</span> <span class="nf">_check_vdw_pair_gm_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="s1">&#39;vdw&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_vdw</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">at_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">vdw</span><span class="p">):</span>
            <span class="n">temp_vdwpair_vdw</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">vdw</span><span class="p">[</span><span class="n">at_pair</span><span class="p">]</span>
            <span class="n">temp_vdwtype2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_interaction_type</span><span class="p">(</span><span class="n">at_pair</span><span class="p">,</span> <span class="n">vdWType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_ff_defaults</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">use_vdw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                       <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">temp_pairtype2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_interaction_type</span><span class="p">(</span><span class="n">at_pair</span><span class="p">,</span> <span class="n">PairType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_ff_defaults</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">use_vdw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                       <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">flag_generated</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">temp_vdwtype2</span><span class="p">:</span>
                <span class="n">temp_vdwtype2</span> <span class="o">=</span> <span class="n">temp_vdwtype2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">temp_pairtype2</span><span class="p">:</span>
                <span class="n">temp_pairtype2</span> <span class="o">=</span> <span class="n">temp_pairtype2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_vdwtype2</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">temp_pairtype2</span> <span class="ow">and</span> <span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">temp_vdwpair_type2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_vdw_atpair_gm</span><span class="p">(</span><span class="n">at_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">at_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">replace</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_vdwtype2</span><span class="p">:</span>
                    <span class="n">temp_vdwtype2</span> <span class="o">=</span> <span class="n">temp_vdwpair_type2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">flag_generated</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_pairtype2</span> <span class="ow">and</span> <span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">temp_pairtype2</span> <span class="o">=</span> <span class="n">temp_vdwpair_type2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">flag_generated</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">temp_new_vdw_pair_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_vdwtype2</span><span class="p">,</span> <span class="n">temp_pairtype2</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_new_vdw_pair_type</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_set_gm_interaction_type_container</span><span class="p">(</span><span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">ff</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">check_eq_params</span><span class="p">(</span><span class="n">temp_new_vdw_pair_type</span><span class="o">.</span><span class="n">p</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">flag_generated</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_set_gm_interaction_type_container</span><span class="p">(</span><span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">ff</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">temp_new_vdw_pair_type</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">temp_vdwpair_vdw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">p</span>

    <span class="k">def</span> <span class="nf">__write_interaction_type_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">int_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_write_ff_int_type</span>
        <span class="n">temp_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(</span><span class="n">int_type</span><span class="p">,</span> <span class="n">cont_pref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_cont_pref</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_cont</span><span class="p">:</span><span class="k">return</span>
        <span class="n">txt2write</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">temp_int_type</span> <span class="ow">in</span> <span class="n">temp_cont</span><span class="p">:</span>
            <span class="n">flag_write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="n">temp_int_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_write</span><span class="p">:</span><span class="k">continue</span>
            <span class="n">defines</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_use_define&#39;</span><span class="p">):</span>
                <span class="n">defines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defines</span>
            <span class="n">temp_txt</span> <span class="o">=</span> <span class="n">temp_int_type</span><span class="o">.</span><span class="n">_write_gm_int_type</span><span class="p">(</span><span class="n">defines</span> <span class="o">=</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">txt2write</span> <span class="o">+=</span> <span class="n">temp_txt</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">txt2write</span>

<div class="viewcode-block" id="gmFFWriter.write_ff_itp"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmFFWriter.write_ff_itp">[docs]</a>    <span class="k">def</span> <span class="nf">write_ff_itp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param f_path:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">             flag_split_non_bonded = False</span>
<span class="sd">             sep2include_files - customizable</span>
<span class="sd">             flag_close = True (close gromacs stream)</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gms_from_fpaht</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_split_non_bonded&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sep2include_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ffnonbonded.itp&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ffbonded.itp&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromacs_format</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">ff_directives</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f_path</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_close&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<span class="n">_gmFFWriter_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_gmFFWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_defaults&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_gm_defaults_v1&#39;</span>
<span class="n">_gmFFWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_atomtypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_gm_atomtypes_v1&#39;</span>
<span class="k">for</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">direction_interaction_type_map</span><span class="p">:</span>
    <span class="n">_gmFFWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_&#39;</span> <span class="o">+</span> <span class="n">temp_dir</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_interaction_type_v1&#39;</span>
<span class="c1">#_gmFFWriter_defs[&#39;_write_gm_cmaptypes&#39;] = &#39;__write_cmaptypes_v1&#39;</span>

<span class="n">gmFFWriter</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_gmFFWriter_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">read / write for rtp???</span>

<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="gmFragmentMoleculeIO"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmFragmentMoleculeIO">[docs]</a><span class="k">class</span> <span class="nc">gmFragmentMoleculeIO</span><span class="p">(</span><span class="n">GromacsParser</span><span class="p">,</span> <span class="n">GromacsWriter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># FF</span>
        <span class="c1">#self.find_interaction_type = None # from FF</span>
        <span class="c1">#self.get_intDB = None # from FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_residue</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Molecule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Molecule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Molecule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cg</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Molecule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Molecule</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__find_a_type_gm</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">atom_type_str</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a_type</span> <span class="ow">in</span> <span class="n">ff</span><span class="o">.</span><span class="n">a_type</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">a_type_gm_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a_type</span><span class="p">,</span> <span class="s1">&#39;gm_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a_type_gm_id</span> <span class="ow">and</span> <span class="n">a_type_gm_id</span><span class="o">==</span><span class="n">atom_type_str</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">a_type</span>

    <span class="k">def</span> <span class="nf">__atoms_parser_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">atom_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
        <span class="n">atom_type_str</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span>
        <span class="n">atom_type</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">atom_type_str</span><span class="p">,</span> <span class="n">AtomType</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">atom_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">atom_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_a_type_gm</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">atom_type_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">atom_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">atom_type</span> <span class="o">=</span> <span class="n">atom_type_str</span>
        <span class="c1">#res_n = int(next(temp))</span>
        <span class="n">res_n</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="c1"># this could apparently be a string as well</span>
        <span class="n">res_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">temp_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_residue</span><span class="p">(</span><span class="n">res_n</span><span class="p">,</span> <span class="n">res_name</span><span class="p">)</span>
        <span class="n">atom_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">cg_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;cg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cg</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="n">cg_n</span><span class="p">:</span>
                <span class="n">temp_cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span> <span class="o">=</span> <span class="nb">list</span><span class="p">)</span>
                <span class="n">temp_cg</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">cg_n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
            <span class="n">temp_cg</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">cg_n</span>
        <span class="n">p_ch</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="n">atom_type</span><span class="o">.</span><span class="n">m</span>
        <span class="n">temp_atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">atom_number</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">atom_name</span><span class="p">)</span>
        <span class="n">temp_atom</span><span class="o">.</span><span class="n">a_type</span> <span class="o">=</span> <span class="n">atom_type</span>
        <span class="n">temp_atom</span><span class="o">.</span><span class="n">p_ch</span> <span class="o">=</span> <span class="n">p_ch</span>
        <span class="n">temp_atom</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">mass</span>
        <span class="n">temp_atom</span><span class="o">.</span><span class="n">_generate_self_state</span><span class="p">()</span>
        <span class="n">temp_res</span><span class="o">.</span><span class="n">gm_id</span> <span class="o">=</span> <span class="n">temp_res</span><span class="o">.</span><span class="n">id</span>
        <span class="n">temp_res</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">temp_atom</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">atom_type_B_str</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">atom_type_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">atom_type_B_str</span><span class="p">,</span> <span class="n">AtomType</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">atom_type_B</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">atom_type_B</span> <span class="o">=</span> <span class="n">atom_type_B_str</span>
            <span class="n">partial_charge_B</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="n">mass_B</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="n">temp_atom</span><span class="o">.</span><span class="n">add_atom_state</span><span class="p">(</span><span class="n">atom_type_B</span><span class="p">,</span> <span class="n">partial_charge_B</span><span class="p">,</span> <span class="n">mass_B</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">temp_atom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_atom</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">temp_atom</span><span class="o">.</span><span class="n">gm_id</span> <span class="o">=</span> <span class="n">temp_atom</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__parse_atoms_gm_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">interaction_type</span><span class="p">):</span>
        <span class="n">na</span> <span class="o">=</span> <span class="n">interaction_type</span><span class="o">.</span><span class="n">na</span>
        <span class="n">temp_l</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">temp_int_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">na</span><span class="p">):</span>
            <span class="n">temp_at_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">))</span>
            <span class="n">temp_int_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">temp_at_id</span><span class="p">]</span>
            <span class="n">temp_int_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_int_at</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_int_atoms</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">na</span>

    <span class="k">def</span> <span class="nf">_parse_gm_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="n">interaction_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default_fnc_type</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># not the nicest solution</span>
        <span class="k">if</span> <span class="n">interaction_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interaction_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_int_type</span>
        <span class="n">temp_int_atoms</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parse_atoms_gm_interaction</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">interaction_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">default_fnc_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;missing function type while reading &quot;</span><span class="p">,</span> <span class="n">interaction_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">fnc_type</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fnc_type</span> <span class="o">=</span> <span class="n">default_fnc_type</span>
        <span class="n">temp_interaction_type</span> <span class="o">=</span> <span class="n">interaction_type</span><span class="p">(</span><span class="n">fnc_type</span> <span class="o">=</span> <span class="n">fnc_type</span><span class="p">)</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">temp_interaction</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="n">temp_interaction_type</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">temp_int_atoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">temp</span><span class="p">:</span>
            <span class="n">temp_int_atom_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_at</span><span class="o">.</span><span class="n">a_type</span> <span class="k">for</span> <span class="n">temp_at</span> <span class="ow">in</span> <span class="n">temp_int_atoms</span><span class="p">]</span>
            <span class="n">temp_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">find_interaction_type</span><span class="p">(</span><span class="n">temp_int_atom_types</span><span class="p">,</span> <span class="n">temp_interaction_type</span><span class="p">,</span> <span class="n">fnc_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">temp_state</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">temp_interaction_type</span><span class="o">!=</span><span class="n">VirtualSitenType</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">temp</span><span class="p">:</span>
                    <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">fnc_type</span> <span class="o">=</span> <span class="n">fnc_type</span><span class="p">)</span>
                    <span class="n">temp_n_param</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_interaction</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p_type</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                        <span class="n">temp_def</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">temp_params</span> <span class="o">=</span> <span class="n">defines</span><span class="p">[</span><span class="n">temp_def</span><span class="p">]</span><span class="o">.</span><span class="n">v</span>
                        <span class="n">temp_interaction</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">temp_params</span><span class="p">)</span>
                        <span class="n">temp_interaction</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">gmdef</span> <span class="o">=</span> <span class="n">temp_def</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp_params</span><span class="p">,</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[:</span><span class="n">temp_n_param</span><span class="p">],</span> <span class="n">temp</span><span class="p">[</span><span class="n">temp_n_param</span><span class="p">:]</span>
                        <span class="n">temp_interaction</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">temp_params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_interaction</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">fnc_type</span> <span class="o">!=</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">temp_at_id</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
                        <span class="n">additional_atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">temp_at_id</span><span class="p">]</span>
                        <span class="n">temp_interaction</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">additional_atom</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">fnc_type</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">:</span>
                            <span class="n">temp_interaction</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">fnc_type</span><span class="o">==</span><span class="s1">&#39;2&#39;</span><span class="p">:</span>
                            <span class="n">temp_interaction</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">additional_atom</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;fnc_type not known&#39;</span><span class="p">,</span> <span class="n">fnc_type</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;number of paramerets wrong: len(temp) % 2 should be 0 &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)):</span>
                        <span class="n">at</span><span class="p">,</span> <span class="n">temp_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]],</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">temp_interaction</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
                        <span class="n">temp_interaction</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__exclusions_parser_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interaction_type&#39;</span><span class="p">,</span> <span class="n">ExclusionType</span><span class="p">)</span>
        <span class="n">temp_l</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">temp_at_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">))</span>
        <span class="n">at1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">temp_at_id</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">temp_at_id</span> <span class="ow">in</span> <span class="n">temp_l</span><span class="p">:</span>
            <span class="n">at2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">temp_at_id</span><span class="p">)]</span>
            <span class="c1">#at1.add_excl(self.atoms[int(temp_at_id)])</span>
            <span class="n">temp_interaction</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="p">(</span><span class="n">at1</span><span class="p">,</span> <span class="n">at2</span><span class="p">))</span>
            <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">fnc_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
            <span class="c1"># exclusion pair type</span>
            <span class="n">temp_interaction</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="n">ExclusionPairType</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="p">(</span><span class="n">at1</span><span class="p">,</span> <span class="n">at2</span><span class="p">))</span>
            <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">fnc_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">item_id</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">((</span><span class="n">at1</span><span class="p">,</span> <span class="n">at2</span><span class="p">)),</span> <span class="n">replace</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_atom_pair2EP_l</span><span class="p">(</span><span class="n">at1</span><span class="p">,</span> <span class="n">at2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__virtualsitesn_parser_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="c1"># it&#39;s in _parse_gm_interaction, but should be separated...</span>
        <span class="k">pass</span>

<span class="c1">#writing part</span>
<span class="c1">######################################################################## PTP missing!!!!!</span>

<div class="viewcode-block" id="gmFragmentMoleculeIO.write_itp"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmFragmentMoleculeIO.write_itp">[docs]</a>    <span class="k">def</span> <span class="nf">write_itp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="n">directives</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gms_from_fpaht</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_molecule_type</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f_path</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_close&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="gmFragmentMoleculeIO.write_molecule_type"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmFragmentMoleculeIO.write_molecule_type">[docs]</a>    <span class="k">def</span> <span class="nf">write_molecule_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">directives</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param gs:</span>
<span class="sd">        :param directives:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">             flag_segment_order = True</span>
<span class="sd">             flag_general_defines = False(from top e.g) - generates defines2write</span>
<span class="sd">             defines2write - container of defines</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mol_id&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_pref</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_generate_excl_pairs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gm_generate_excl_pairs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">top_state</span><span class="p">,</span> <span class="n">other_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_top_other_state</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">top_other_state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">top_state</span><span class="o">=</span><span class="n">top_state</span><span class="p">,</span> <span class="n">other_state</span><span class="o">=</span><span class="n">other_state</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">top_other_state</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_ff_defines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_segment_order&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gm_segments_writing_stack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="p">,</span> <span class="s1">&#39;_segments&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;gm_ord&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">_segments</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">_segments</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gm_segments_writing_stack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">_segments</span><span class="p">[</span><span class="n">pos</span><span class="p">:])</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_segments&#39;</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gm_segments_writing_stack&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_general_defines&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defines2write&#39;</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;defines2write&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="p">,</span> <span class="s1">&#39;defines&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gm_segments_writing_stack&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_defines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#        kwargs[&#39;check_self_flag_write&#39;] = 1</span>
<span class="c1">#        if self._check_flag_write(self, **kwargs):</span>
        <span class="k">if</span> <span class="n">directives</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directives</span> <span class="o">=</span> <span class="n">mol_directives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromacs_format</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">directives</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__write_moleculetype_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{:&lt;20}</span><span class="s1"> </span><span class="si">{:}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrexcl</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="n">__atom_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="s1">&#39;</span>
    <span class="n">__atom_type_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;6s}</span><span class="s1">&#39;</span>
    <span class="n">__atoms_line_format1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;6}{:&gt;11}{:&gt;7}{:&gt;7}{:&gt;7}{:&gt;7}</span><span class="s1">&#39;</span>
    <span class="n">__pch_format</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{:&gt;10f}</span><span class="s1">&#39;</span>
    <span class="n">__m_format</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{:&gt;10f}</span><span class="s1">&#39;</span>
    <span class="n">__fnc_type_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5s}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__write_atoms_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">txt2write</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">a_type_kwargs</span><span class="p">,</span> <span class="n">m_kwargs</span><span class="p">,</span> <span class="n">pch_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_atom_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ptp_atom_text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__atom_type_format</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pch_format</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__m_format</span>
        <span class="k">for</span> <span class="n">at_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="n">at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at_id</span><span class="p">]</span>
            <span class="n">flag_write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_write</span><span class="p">:</span><span class="k">continue</span>
            <span class="n">a_type_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">a_type_kwargs</span><span class="p">)</span>
            <span class="n">m_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">m_kwargs</span><span class="p">)</span>
            <span class="n">p_ch_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">pch_kwargs</span><span class="p">)</span>
            <span class="n">a_type_ptp</span><span class="p">,</span> <span class="n">m_ptp</span><span class="p">,</span> <span class="n">p_ch_ptp</span><span class="p">,</span> <span class="n">flag_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_ptp_states</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">a_type_ptp</span><span class="p">,</span> <span class="n">m_ptp</span><span class="p">,</span> <span class="n">p_ch_ptp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">txt2write</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__atoms_line_format1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gm_id&#39;</span><span class="p">),</span>
                                <span class="n">get_id_string</span><span class="p">(</span><span class="n">a_type_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gm_id&#39;</span><span class="p">),</span> <span class="n">get_id_string</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">res</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gm_id&#39;</span><span class="p">),</span>
                                                          <span class="n">at</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">cg</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
            <span class="n">txt2write</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pch_format</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__m_format</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_ch_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">## PTP</span>
            <span class="k">if</span> <span class="n">flag_ptp</span><span class="p">:</span>
                <span class="n">txt2write</span> <span class="o">+=</span> <span class="n">ptp_atom_text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">a_type_ptp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gm_id&#39;</span><span class="p">),</span> <span class="n">p_ch_ptp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_ptp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">txt2write</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">txt2write</span>

    <span class="k">def</span> <span class="nf">__write_interactions_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">int_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interaction_type&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_curr_write_mol_int_type</span><span class="p">)</span>
        <span class="n">int_container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">int_type</span><span class="o">.</span><span class="n">find_int_container2write</span><span class="p">(),</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">int_container</span><span class="p">:</span><span class="k">return</span>
        <span class="n">txt2write</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">temp_interaction</span> <span class="ow">in</span> <span class="n">int_container</span><span class="p">:</span>
            <span class="n">flag_write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_flag_write</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_write</span><span class="p">:</span><span class="k">continue</span>
            <span class="n">temp_txt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__atom_format</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_interaction</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
            <span class="n">txt2write</span> <span class="o">+=</span> <span class="n">temp_txt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gm_id&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">temp_interaction</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>
            <span class="n">temp_int_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_int_ptp</span><span class="p">:</span>
                <span class="n">state4writing</span><span class="p">,</span> <span class="n">ptp_state4writing</span> <span class="o">=</span> <span class="n">temp_int_ptp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ptp_state4writing</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">state4writing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            if hasattr(temp_interaction, &#39;state&#39;):</span>
<span class="sd">                state4writing = temp_interaction.state</span>
<span class="sd">            else:</span>
<span class="sd">                state4writing = self.get_state(temp_interaction.states, **kwargs)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">state4writing</span><span class="p">,</span> <span class="s1">&#39;gm_int_type&#39;</span><span class="p">):</span>
                <span class="n">temp_gm_int_type</span> <span class="o">=</span> <span class="n">state4writing</span><span class="o">.</span><span class="n">gm_int_type</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_gm_int_type</span> <span class="o">=</span> <span class="n">state4writing</span>
            <span class="k">if</span> <span class="n">ptp_state4writing</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ptp_state4writing</span><span class="p">,</span> <span class="s1">&#39;gm_int_type&#39;</span><span class="p">):</span>
                <span class="n">temp_ptp_gm_int_type</span> <span class="o">=</span> <span class="n">ptp_state4writing</span><span class="o">.</span><span class="n">gm_int_type</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_ptp_gm_int_type</span> <span class="o">=</span> <span class="n">ptp_state4writing</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            if temp_interaction.states[0].fnc_type==&#39;gr_fnc&#39;:</span>
<span class="sd">                temp_gm_int_type = getattr(temp_interaction.states[0],&#39;gm_int_type&#39;, None)</span>
<span class="sd">                if temp_gm_int_type is None:</span>
<span class="sd">                    temp_gm_int_type = temp_interaction.states[0].gr2gm(**kwargs)</span>
<span class="sd">            else:</span>
<span class="sd">                temp_gm_int_type = temp_interaction.states[0]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">temp_gm_int_type</span><span class="o">.</span><span class="n">fnc_type</span><span class="p">:</span>
                <span class="n">txt2write</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fnc_type_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp_gm_int_type</span><span class="o">.</span><span class="n">fnc_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;write_params&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">flag_write_params</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;write_params_explicitly&#39;</span><span class="p">):</span>
                    <span class="n">temp_int_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">find_interaction_type</span><span class="p">(</span><span class="n">temp_interaction</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">temp_interaction</span><span class="o">.</span><span class="n">int_type</span><span class="p">,</span>
                        <span class="n">temp_gm_int_type</span><span class="o">.</span><span class="n">fnc_type</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_multiple_matches</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    temp_int_type = self.ff.find_interaction_type(temp_interaction.atoms, temp_interaction.int_type,</span>
<span class="sd">                        temp_gm_int_type.fnc_type, int_type_container = [temp_interaction._sol[0]],</span>
<span class="sd">                                                                  create = False, allow_not_found=1)</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                    <span class="k">if</span> <span class="n">temp_int_type</span> <span class="ow">and</span> <span class="n">temp_int_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">check_eq_params</span><span class="p">(</span><span class="n">temp_gm_int_type</span><span class="o">.</span><span class="n">p</span><span class="p">):</span>
                        <span class="n">flag_write_params</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">flag_write_params</span><span class="p">:</span>
                    <span class="n">defines</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_use_define&#39;</span><span class="p">):</span>
                        <span class="n">defines</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defines&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="p">,</span> <span class="s1">&#39;defines&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                    <span class="n">txt2write</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">temp_gm_int_type</span><span class="o">.</span><span class="n">_write_gm_params</span><span class="p">(</span><span class="n">defines</span> <span class="o">=</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="c1"># PTP interaction</span>
                <span class="k">if</span> <span class="n">temp_ptp_gm_int_type</span> <span class="ow">and</span> <span class="n">temp_ptp_gm_int_type</span><span class="o">!=</span><span class="n">Dummy</span><span class="p">:</span> <span class="c1"># actually, this should be split to if temp_ptp_gm_int_type -&gt; remove</span>
                    <span class="n">flag_write_params</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;write_params_explicitly&#39;</span><span class="p">):</span> <span class="c1">######################### this part has to be adjusted for PTP atom types</span>
                        <span class="n">temp_int_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">.</span><span class="n">find_interaction_type</span><span class="p">(</span><span class="n">temp_interaction</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">temp_interaction</span><span class="o">.</span><span class="n">int_type</span><span class="p">,</span>
                        <span class="n">temp_ptp_gm_int_type</span><span class="o">.</span><span class="n">fnc_type</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_multiple_matches</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">temp_int_type</span> <span class="ow">and</span> <span class="n">temp_int_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">check_eq_params</span><span class="p">(</span><span class="n">temp_ptp_gm_int_type</span><span class="o">.</span><span class="n">p</span><span class="p">):</span>
                            <span class="n">flag_write_params</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">flag_write_params</span><span class="p">:</span>
                        <span class="n">defines</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_use_define&#39;</span><span class="p">):</span>
                            <span class="n">defines</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defines&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="p">,</span> <span class="s1">&#39;defines&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                        <span class="n">txt2write</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">temp_ptp_gm_int_type</span><span class="o">.</span><span class="n">_write_gm_params</span><span class="p">(</span><span class="n">defines</span> <span class="o">=</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">txt2write</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">txt2write</span>

    <span class="k">def</span> <span class="nf">__write_exclusions_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;write_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;interaction_type&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">ExclusionType</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_interactions_v1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_interactions_v1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="n">_gmFragmentMoleculeIO_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">[</span><span class="s1">&#39;_atoms_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__atoms_parser_v1&#39;</span>
<span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">[</span><span class="s1">&#39;_exclusions_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__exclusions_parser_v1&#39;</span>
<span class="k">for</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">direction_interaction_map</span><span class="p">:</span>
    <span class="n">temp_dir_fnc_attr</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">temp_dir</span><span class="o">+</span><span class="s1">&#39;_parser&#39;</span>
    <span class="k">if</span> <span class="n">temp_dir_fnc_attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">:</span>
        <span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">[</span><span class="n">temp_dir_fnc_attr</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_parse_gm_interaction&#39;</span>

<span class="n">mol_directives</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;moleculetype&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">,</span> <span class="s1">&#39;bonds&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusions&#39;</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">direction_interaction_map</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">temp_dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mol_directives</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">mol_directives</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>

<span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_moleculetype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_moleculetype_v1&#39;</span>
<span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_atoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_atoms_v1&#39;</span>
<span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_exclusions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_exclusions_v1&#39;</span>

<span class="k">for</span> <span class="n">temp_dir</span> <span class="ow">in</span> <span class="n">direction_interaction_map</span><span class="p">:</span>
    <span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_&#39;</span> <span class="o">+</span> <span class="n">temp_dir</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_interactions_v1&#39;</span>

<span class="n">gmFragmentMoleculeIO</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_gmFragmentMoleculeIO_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="gmTopologyIO"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmTopologyIO">[docs]</a><span class="k">class</span> <span class="nc">gmTopologyIO</span><span class="p">(</span><span class="n">GromacsParser</span><span class="p">,</span> <span class="n">GromacsWriter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Molecule</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MoleculeType</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule_types</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="gmTopologyIO.parse_top_gm"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmTopologyIO.parse_top_gm">[docs]</a>    <span class="k">def</span> <span class="nf">parse_top_gm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_gm</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule_types</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">mt</span><span class="o">.</span><span class="n">add_exclusions_neigh</span><span class="p">(</span><span class="n">nexcl</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">nrexcl</span><span class="p">)</span>
            <span class="n">pairs_cont</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">PairType</span><span class="p">,</span> <span class="n">flag_class</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pairs_cont</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">temp_pair</span> <span class="ow">in</span> <span class="n">pairs_cont</span><span class="p">:</span>
                    <span class="n">temp_interaction</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="n">ExclusionPairType</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">temp_pair</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
                    <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">fnc_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
                    <span class="n">mt</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">item_id</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">temp_pair</span><span class="o">.</span><span class="n">atoms</span><span class="p">),</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="n">at1</span><span class="p">,</span> <span class="n">at2</span> <span class="o">=</span> <span class="n">temp_pair</span><span class="o">.</span><span class="n">atoms</span>
                    <span class="n">mt</span><span class="o">.</span><span class="n">add_atom_pair2EP_l</span><span class="p">(</span><span class="n">at1</span><span class="p">,</span> <span class="n">at2</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__moleculetype_parser_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_l</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">temp_mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MoleculeType</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)),</span> <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_mol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_mol</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curr_bbmol</span> <span class="o">=</span> <span class="n">temp_mol</span>

    <span class="k">def</span> <span class="nf">__system_parser_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">curr_directive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_curr_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">file_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">curr_directive</span><span class="p">,</span> <span class="n">DescriptionPart</span><span class="o">.</span><span class="n">container2write</span><span class="p">):</span>
            <span class="n">temp_sys_title</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">curr_directive</span><span class="p">,</span> <span class="n">DescriptionPart</span><span class="o">.</span><span class="n">container2write</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_sys_title</span> <span class="o">=</span> <span class="n">DescriptionPart</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;gm&#39;</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">curr_directive</span><span class="p">,</span> <span class="n">DescriptionPart</span><span class="o">.</span><span class="n">container2write</span><span class="p">,</span> <span class="n">temp_sys_title</span><span class="p">)</span>
        <span class="n">temp_sys_title</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">temp_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">temp_sys_title</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">flag_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_sys_title</span><span class="p">)</span>
        <span class="n">temp_sys_title</span><span class="o">.</span><span class="n">flag_gm_system</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_sys_title</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__molecules_parser_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_l</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">temp_mol_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">MoleculeType</span><span class="p">)</span>
        <span class="n">temp_mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">temp_mol_type</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp_l</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_gm_ord</span><span class="p">(</span><span class="n">temp_mol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_mol</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<span class="c1">#writing</span>
    <span class="n">__molecule_name_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20}</span><span class="s1">&#39;</span>

    <span class="c1">#def __write_gm_moleculetype_v1(self, gs, directives = None, **kwargs):</span>
    <span class="k">def</span> <span class="nf">__write_gm_moleculetype_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gm_writing_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span>
        <span class="n">molecules2write</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;molecules2write&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">molecules2write</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">molecules2write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">sep_mol2itp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sep_mol2itp&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sep_mol2itp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sep_mol2itp</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sep_mol2itp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sep_mol2itp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sep_mol2itp</span><span class="p">:</span>
            <span class="n">sep_mol2itp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">sep_mol2exclude</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sep_mol2exclude&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_sep_mol_exclude_included&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">mol_type_id</span> <span class="ow">in</span> <span class="n">molecules2write</span><span class="p">:</span>
                    <span class="n">mol_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">[</span><span class="n">mol_type_id</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mol_type</span><span class="p">,</span> <span class="s1">&#39;gm_ord&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mol_type</span><span class="o">.</span><span class="n">gm_ord</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">sep_mol2exclude</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mol_type_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">mol_type_id</span> <span class="ow">in</span> <span class="n">molecules2write</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mol_type_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sep_mol2exclude</span><span class="p">:</span>
                    <span class="n">sep_mol2itp</span><span class="p">[</span><span class="n">mol_type_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">sep_mol2itp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mol_type_id</span><span class="p">,</span> <span class="n">mol_type_id</span> <span class="o">+</span> <span class="s1">&#39;.itp&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mol_type_id</span> <span class="ow">in</span> <span class="n">molecules2write</span><span class="p">:</span>
            <span class="n">mol_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">[</span><span class="n">mol_type_id</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mol_type_id</span> <span class="ow">in</span> <span class="n">sep_mol2itp</span><span class="p">:</span>
                <span class="n">temp_fpath</span> <span class="o">=</span> <span class="n">sep_mol2itp</span><span class="p">[</span><span class="n">mol_type_id</span><span class="p">]</span>
                <span class="n">new_gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_include_gs2writing_state</span><span class="p">(</span><span class="n">temp_fpath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c1">#                self._write_include(self._gm_writing_state[-1][0][-1], temp_fpath, **kwargs)</span>
<span class="c1">#                new_gs = GromacsFile(temp_fpath, True)</span>
<span class="c1">#                self._add_gs2writing_state(new_gs)</span>
            <span class="n">mol_type</span><span class="o">.</span><span class="n">write_molecule_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mol_type_id</span> <span class="ow">in</span> <span class="n">sep_mol2itp</span><span class="p">:</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_gs_from_writing_state</span><span class="p">()</span>
<span class="c1">#                self._gm_writing_state[-1][0].pop(-1)</span>

    <span class="k">def</span> <span class="nf">_write_gm_top_moleculetype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_gm_moleculetype_v</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_gm_system_txt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;molecular system&#39;</span>

    <span class="k">def</span> <span class="nf">__write_system_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">txt2write</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">temp_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">DescriptionPart</span><span class="p">,</span> <span class="n">flag_class</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dp</span> <span class="ow">in</span> <span class="n">temp_cont</span><span class="p">:</span>
            <span class="n">flag_dp</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s1">&#39;flag_gm_system&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">flag_dp</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_gm_ord</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s1">&#39;gm_ord&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp_gm_ord</span>  <span class="ow">and</span> <span class="n">temp_gm_ord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">seg_type</span> <span class="o">==</span> <span class="s1">&#39;gm_directive&#39;</span> <span class="ow">and</span> <span class="n">temp_gm_ord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">seg_name</span> <span class="o">==</span> <span class="s1">&#39;system&#39;</span><span class="p">:</span>
                    <span class="n">flag_dp</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">flag_dp</span> <span class="ow">and</span> <span class="n">dp</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                <span class="n">txt2write</span><span class="o">+=</span><span class="n">dp</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">txt2write</span><span class="p">:</span>
            <span class="n">txt2write</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_gm_system_txt</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">txt2write</span>

    <span class="k">def</span> <span class="nf">__write_molecules_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">txt2write</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="n">txt2write</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__molecule_name_format</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">{:}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">mol_type</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">txt2write</span>

<div class="viewcode-block" id="gmTopologyIO.write_top_gm"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmTopologyIO.write_top_gm">[docs]</a>    <span class="k">def</span> <span class="nf">write_top_gm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param f_path:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">            see write_ff_itp</span>
<span class="sd">            sep_ff2itp - separate ff into itp file(s)</span>
<span class="sd">            sep_mol2itp - separate molecules to itp files</span>
<span class="sd">                sep_mol2itp = {mol_id1:f_path1}</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gms_from_fpaht</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="n">ff_kwargs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ff_kwargs</span><span class="p">[</span><span class="s1">&#39;flag_del_writing_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ff_kwargs</span><span class="p">[</span><span class="s1">&#39;flag_close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">sep_ff2itp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sep_ff2itp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sep_ff2itp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sep_ff2itp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sep_ff2itp</span> <span class="o">=</span> <span class="s1">&#39;ff.itp&#39;</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sep_ff2itp</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">ff_kwargs</span><span class="p">[</span><span class="s1">&#39;last_inc_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sep_ff2itp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_ff_itp</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">ff_kwargs</span><span class="p">)</span>
<span class="c1">#        self.write_gromacs_format(gs, ff_directives, **kwargs)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_gm_top_moleculetype</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gm_writing_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm_writing_state</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gm_segments_writing_stack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments_writing_stack</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flag_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromacs_format</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">top_directives</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f_path</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_close&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<span class="n">_gmTopologyIO_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_gmTopologyIO_defs</span><span class="p">[</span><span class="s1">&#39;_moleculetype_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__moleculetype_parser_v1&#39;</span>
<span class="n">_gmTopologyIO_defs</span><span class="p">[</span><span class="s1">&#39;_molecules_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__molecules_parser_v1&#39;</span>
<span class="n">_gmTopologyIO_defs</span><span class="p">[</span><span class="s1">&#39;_system_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__system_parser_v1&#39;</span>

<span class="n">_gmTopologyIO_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_system_v1&#39;</span>
<span class="n">_gmTopologyIO_defs</span><span class="p">[</span><span class="s1">&#39;__write_gm_moleculetype_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_gm_moleculetype_v1&#39;</span>
<span class="n">_gmTopologyIO_defs</span><span class="p">[</span><span class="s1">&#39;_write_gm_molecules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_molecules_v1&#39;</span>

<span class="n">gmTopologyIO</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_gmTopologyIO_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="gmConfigurationIO"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmConfigurationIO">[docs]</a><span class="k">class</span> <span class="nc">gmConfigurationIO</span><span class="p">(</span><span class="n">GromacsParser</span><span class="p">,</span> <span class="n">GromacsWriter</span><span class="p">):</span>
    <span class="n">__line_form</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span> <span class="c1">#resnum,res_name,at_name,at_num,x,y,z</span>
    <span class="n">__var_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;res_id&#39;</span><span class="p">,</span> <span class="s1">&#39;res_name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;gm_id&#39;</span><span class="p">]</span>
    <span class="n">__var_type</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_cols</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">N_characters</span><span class="p">,</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="c1"># this has to go somewhere more general!</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">N_ch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">N_characters</span><span class="p">):</span>
            <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">N_ch</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos2</span><span class="p">])</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos2</span>
        <span class="k">return</span> <span class="n">values</span>

<div class="viewcode-block" id="gmConfigurationIO.parse_gro"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmConfigurationIO.parse_gro">[docs]</a>    <span class="k">def</span> <span class="nf">parse_gro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="n">temp_title</span> <span class="o">=</span> <span class="n">DescriptionPart</span><span class="p">(</span><span class="n">form</span> <span class="o">=</span> <span class="s1">&#39;gm&#39;</span><span class="p">)</span>
        <span class="n">temp_title</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_title</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">N_atoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N_atoms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N_dim</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N_atoms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N_dim</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">at_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_atoms</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cols</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__line_form</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__var_type</span><span class="p">)</span>
            <span class="n">at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__var_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">at</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">gm_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_coord</span><span class="p">[</span><span class="n">at_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">at</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coord</span><span class="p">[</span><span class="n">at_i</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">temp_vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cols</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__line_form</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__var_type</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">offset</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__line_form</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vel</span><span class="p">[</span><span class="n">at_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_vel</span>
                <span class="n">at</span><span class="o">.</span><span class="n">vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vel</span><span class="p">[</span><span class="n">at_i</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">box_vec</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">box_v</span><span class="p">)</span> <span class="k">for</span> <span class="n">box_v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">vec</span> <span class="o">=</span> <span class="n">box_vec</span><span class="p">)</span></div>

<div class="viewcode-block" id="gmConfigurationIO.write_gro"><a class="viewcode-back" href="../../../../../SMArt.md.gromacs.io.html#SMArt.md.gromacs.io.incl.gmConfigurationIO.write_gro">[docs]</a>    <span class="k">def</span> <span class="nf">write_gro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<span class="n">_gmConfigurationIO_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_gmConfigurationIO_defs</span><span class="p">[</span><span class="s1">&#39;__line_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
<span class="n">_gmConfigurationIO_defs</span><span class="p">[</span><span class="s1">&#39;__var_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="n">gmConfigurationIO</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_gmConfigurationIO_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>














</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Drazen Petrov.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>