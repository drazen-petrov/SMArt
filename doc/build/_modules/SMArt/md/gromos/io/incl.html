

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>SMArt.md.gromos.io.incl &mdash; SMArt v1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> SMArt
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">SMArt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Tutorial/index.html">Tutorial</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">SMArt</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../md.html">SMArt.md</a> &raquo;</li>
        
      <li>SMArt.md.gromos.io.incl</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for SMArt.md.gromos.io.incl</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">SMArt.incl</span> <span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">do_warn</span>
<span class="kn">from</span> <span class="nn">SMArt.incl</span> <span class="kn">import</span> <span class="n">Defaults</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">GeneralContainer</span><span class="p">,</span> <span class="n">FileStream</span><span class="p">,</span> <span class="n">StringStream</span><span class="p">,</span> <span class="n">split_gen</span><span class="p">,</span> <span class="n">get_id_string</span>
<span class="kn">from</span> <span class="nn">SMArt.md.incl</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">SMArt.md.incl</span> <span class="kn">import</span> <span class="n">_gr_title_gm_system</span><span class="p">,</span> <span class="n">_file_type_ext_map</span><span class="p">,</span> <span class="n">_add_DescriptionPart</span>
<span class="kn">from</span> <span class="nn">..incl</span> <span class="kn">import</span> <span class="n">GromosDefaults</span><span class="p">,</span> <span class="n">GromosBlockNames</span>

<span class="c1">#### GENERAL CLASSES / FUNCTIONS</span>

<div class="viewcode-block" id="GromosStream"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosStream">[docs]</a><span class="k">class</span> <span class="nc">GromosStream</span><span class="p">(</span><span class="n">Defaults</span><span class="p">):</span>
    <span class="n">_comm_indicators</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,)</span>
    <span class="n">_blockend</span> <span class="o">=</span> <span class="s1">&#39;END&#39;</span>
    <span class="n">__buffer_l</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#this is implemented in GromosFile or GromosString</span>

<div class="viewcode-block" id="GromosStream.block_lines"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosStream.block_lines">[docs]</a>    <span class="k">def</span> <span class="nf">block_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;generator yielding line by line of a block (comments removed)&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_blockend</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">block_split_fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;generator yielding elements of a block split by empty spaces (&#39; &#39; or &#39;\t&#39; ...)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_lines</span><span class="p">()))</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">break</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">report_nl_block_split_fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">split_gen</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="GromosStream.end_block_split"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosStream.end_block_split">[docs]</a>    <span class="k">def</span> <span class="nf">end_block_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bl_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the last END of the block - basically a workaround&quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffer_l</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">temp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;more arguments than expected in block: &quot;</span> <span class="o">+</span> <span class="n">bl_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="GromosStream.next_block"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosStream.next_block">[docs]</a>    <span class="k">def</span> <span class="nf">next_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;goes to the next block - reads lines till the end of the block&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_blockend</span><span class="p">):</span>
                <span class="k">return</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">block_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the whole file and yields block names&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_blockend</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">()))</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="k">pass</span>

<span class="c1"># writing part</span>
<div class="viewcode-block" id="GromosStream.write_block"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosStream.write_block">[docs]</a>    <span class="k">def</span> <span class="nf">write_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">,</span> <span class="n">text2write</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;text2write: str or list of lines&quot;&quot;&quot;</span>
        <span class="n">s2w</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">s2w</span><span class="o">+=</span><span class="n">bl_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="c1">#self.f.write(bl_name + &#39;\n&#39;)</span>
        <span class="k">try</span><span class="p">:</span><span class="c1">## python2 unicode</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text2write</span><span class="p">)</span> <span class="o">==</span> <span class="n">unicode</span><span class="p">:</span>
                <span class="n">text2write</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text2write</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text2write</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">text2write</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">text2write</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">s2w</span> <span class="o">+=</span> <span class="n">text2write</span>
            <span class="c1">#self.f.write(text2write)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">text2write</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">text2write</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">s2w</span> <span class="o">+=</span> <span class="n">i</span>
                <span class="c1">#self.f.write(i)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;text2write expected to be str or list - provided &quot;</span> <span class="o">+</span> <span class="nb">type</span><span class="p">(</span><span class="n">text2write</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">s2w</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blockend</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="c1">#self.f.write(self._blockend + &#39;\n&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s2w</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GromosString</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">+=</span><span class="n">s2w</span></div></div>

<span class="n">GromosStream</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">({</span><span class="s1">&#39;_blockend&#39;</span><span class="p">:</span><span class="s1">&#39;END&#39;</span><span class="p">,</span> <span class="s1">&#39;_comm_indicators&#39;</span><span class="p">:(</span><span class="s1">&#39;#&#39;</span><span class="p">,)})</span>


<div class="viewcode-block" id="GromosFile"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosFile">[docs]</a><span class="k">class</span> <span class="nc">GromosFile</span><span class="p">(</span><span class="n">FileStream</span><span class="p">,</span> <span class="n">GromosStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;handler class for gromos files - reading / writing functions&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="GromosString"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosString">[docs]</a><span class="k">class</span> <span class="nc">GromosString</span><span class="p">(</span><span class="n">StringStream</span><span class="p">,</span> <span class="n">GromosStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;handler class for gromos string - reading / writing functions&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="c1"># parsing &amp; writing classes and functions</span>
<span class="c1"># these classes assume that they would be used as subclasses, so some functions are not explicitly available here...</span>

<span class="c1">##### General parsing</span>

<div class="viewcode-block" id="GromosParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosParser">[docs]</a><span class="k">class</span> <span class="nc">GromosParser</span><span class="p">(</span><span class="n">GeneralContainer</span><span class="p">,</span> <span class="n">GromosDefaults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;contains basic functions that allow reading of different blocks&quot;&quot;&quot;</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__parse_from_source</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">,</span> <span class="p">(</span><span class="n">GromosFile</span><span class="p">,</span> <span class="n">GromosString</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">parsing_from</span>
        <span class="k">if</span> <span class="n">parse_from_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GromosFile</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GromosString</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_gr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        parsing gromos format</span>
<span class="sd">        :param parse_from:</span>
<span class="sd">        :param parse_from_file:</span>
<span class="sd">        :param kwargs:</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parse_gr_v</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__find_parse_fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">bl_name</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">):</span>
            <span class="n">fnc_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">bl_name</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnc_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">do_warn</span><span class="p">(</span><span class="s1">&#39;unknown block read in as text: &#39;</span> <span class="o">+</span> <span class="n">bl_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_unknown_block</span>

    <span class="k">def</span> <span class="nf">__parse_gr_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsing_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parse_from_source</span><span class="p">(</span><span class="n">parsing_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;parsed_from&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parsed_from</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parsed_from</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;undefined_bl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undefined_bl</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gs</span><span class="o">.</span><span class="n">lines</span><span class="p">():</span>
            <span class="n">bl_name</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">temp_fnc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_parse_fnc</span><span class="p">(</span><span class="n">bl_name</span><span class="p">)</span>
            <span class="n">temp_fnc</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">bl_name</span><span class="o">=</span><span class="n">bl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">_remove_f</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__read_unknown_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undefined_bl</span><span class="p">[</span><span class="n">bl_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_lines</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__TITLE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_title</span> <span class="o">=</span> <span class="n">DescriptionPart</span><span class="p">(</span><span class="n">form</span> <span class="o">=</span> <span class="s1">&#39;gr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_add_source&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">temp_title</span><span class="o">.</span><span class="n">_add_source</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">f_path</span><span class="p">,</span> <span class="n">additional_txt</span> <span class="o">=</span> <span class="s1">&#39;GROMOS&#39;</span><span class="p">)</span>
        <span class="n">temp_title</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_lines</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_title</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="GromosParser.add_gr_title"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosParser.add_gr_title">[docs]</a>    <span class="k">def</span> <span class="nf">add_gr_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title_lines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_title</span> <span class="o">=</span> <span class="n">DescriptionPart</span><span class="p">(</span><span class="n">form</span> <span class="o">=</span> <span class="s1">&#39;gr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">temp_title</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">title_lines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_title</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__PHYSICALCONSTANTS_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gr_block_names</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bl_name&#39;</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_lines</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">__oneliner_block_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_lines</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;expected 1 line block and got &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gr_block_names</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bl_name&#39;</span><span class="p">]),</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>

<span class="n">_GromosParser_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_GromosParser_defs</span><span class="p">[</span><span class="s1">&#39;__parse_gr_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__parse_gr_v1&#39;</span> <span class="c1"># this will take __parse_gr_v1 function</span>
<span class="n">_GromosParser_defs</span><span class="p">[</span><span class="s1">&#39;_TITLE_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__TITLE_v1&#39;</span>
<span class="n">_GromosParser_defs</span><span class="p">[</span><span class="s1">&#39;_FORCEFIELD_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__oneliner_block_v1&#39;</span>
<span class="n">_GromosParser_defs</span><span class="p">[</span><span class="s1">&#39;_MAKETOPVERSION_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__oneliner_block_v1&#39;</span>
<span class="n">_GromosParser_defs</span><span class="p">[</span><span class="s1">&#39;_PHYSICALCONSTANTS_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__PHYSICALCONSTANTS_v1&#39;</span>
<span class="n">_GromosParser_defs</span><span class="p">[</span><span class="s1">&#39;_oneliner_block&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__oneliner_block_v1&#39;</span>

<span class="n">GromosParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GromosParser_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">##### General writing</span>

<div class="viewcode-block" id="GromosWriter"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosWriter">[docs]</a><span class="k">class</span> <span class="nc">GromosWriter</span><span class="p">(</span><span class="n">GeneralContainer</span><span class="p">,</span> <span class="n">GromosDefaults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;contains basic functions that allow writing of different blocks&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_grs_from_fpaht</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fpath</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">GromosFile</span><span class="p">):</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="n">fpath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="n">GromosFile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">GromosString</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">gs</span>

    <span class="k">def</span> <span class="nf">__write_unknown_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">blocks</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">bl</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;undefined_bl&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">undefined_bl</span><span class="p">:</span>
                <span class="n">gs</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">undefined_bl</span><span class="p">[</span><span class="n">bl</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">do_warn</span><span class="p">(</span><span class="s1">&#39;block name not found in undefined_bl:&#39;</span> <span class="o">+</span> <span class="n">bl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_general_block_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">text2write</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gr_block_names</span><span class="p">,</span> <span class="n">bl</span><span class="p">))</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">text2write</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_TITLE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">form</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">temp_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">DescriptionPart</span><span class="p">,</span> <span class="n">flag_class</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp_cont</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">file_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">file_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">file_type</span><span class="o">!=</span><span class="n">file_type</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">form</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">form</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">form</span><span class="o">!=</span><span class="n">form</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">temp_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">first_line</span><span class="p">)</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">temp_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">temp_lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_gromos_format_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">blocks</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">check_unknown_bl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;check_unknown_bl&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">temp_s</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;get_str&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">temp_s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">bl</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_write_&#39;</span> <span class="o">+</span> <span class="n">bl</span><span class="p">):</span>
                <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_write_&#39;</span> <span class="o">+</span> <span class="n">bl</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gr_block_names</span><span class="p">,</span> <span class="n">bl</span><span class="p">):</span>
                <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_general_block_v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">check_unknown_bl</span><span class="p">:</span>
                <span class="n">temp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_unknown_blocks</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp_f</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;get_str&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">temp_s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_s</span>

<div class="viewcode-block" id="GromosWriter.write_gromos_format"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GromosWriter.write_gromos_format">[docs]</a>    <span class="k">def</span> <span class="nf">write_gromos_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">blocks</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_gromos_format_v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_f</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">blocks</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>

<span class="n">_GromosWriter_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_GromosWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_general_block_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_general_block_v1&#39;</span>
<span class="n">_GromosWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_gromos_format_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_gromos_format_v1&#39;</span>
<span class="n">_GromosWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_TITLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_TITLE_v1&#39;</span>

<span class="n">GromosWriter</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GromosWriter_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># FF (IFP) parsing &amp; writing functions</span>
<span class="n">block_interaction_type_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">block_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;BONDSTRETCHTYPECODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BondType</span>
<span class="n">block_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;BONDANGLEBENDTYPECODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AngleType</span>
<span class="n">block_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;IMPDIHEDRALTYPECODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImproperType</span>
<span class="n">block_interaction_type_map</span><span class="p">[</span><span class="s1">&#39;TORSDIHEDRALTYPECODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DihedralType</span>

<span class="n">top_block_interaction_type_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">temp_bl</span> <span class="ow">in</span> <span class="n">block_interaction_type_map</span><span class="p">:</span>
    <span class="n">top_block_interaction_type_map</span><span class="p">[</span><span class="n">temp_bl</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">block_interaction_type_map</span><span class="p">[</span><span class="n">temp_bl</span><span class="p">]</span>

<div class="viewcode-block" id="IFPBlocksParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.IFPBlocksParser">[docs]</a><span class="k">class</span> <span class="nc">IFPBlocksParser</span><span class="p">(</span><span class="n">GromosParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;contains functions that read of different IFP-related blocks&quot;&quot;&quot;</span>
<div class="viewcode-block" id="IFPBlocksParser.parse_ifp"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.IFPBlocksParser.parse_ifp">[docs]</a>    <span class="k">def</span> <span class="nf">parse_ifp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parses an ifp file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gr</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_imp_pairs</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_vdw</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># from FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_vdw</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># from FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># from FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_interaction_type_code_v</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># from defaults defined below</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_imp_pairs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_gr_interaction_type_container</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__MASSATOMTYPECODE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">n_last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">m_type_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">temp_masstype</span> <span class="o">=</span> <span class="n">MassType</span><span class="p">(</span><span class="n">m_type_id</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">),</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_masstype</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__SINGLEATOMLJPAIR_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">read_a_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_at</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_at</span><span class="p">):</span>
            <span class="n">atom_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">read_a_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_id</span><span class="p">)</span>
            <span class="n">atom_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">temp_c612</span><span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">temp_c612</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)))</span>
            <span class="n">temp_rules</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_at</span><span class="p">):</span>
                <span class="n">temp_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)))</span>
            <span class="n">temp_atom_type</span> <span class="o">=</span> <span class="n">AtomType</span><span class="p">(</span><span class="n">atom_id</span><span class="p">,</span> <span class="n">atom_name</span><span class="p">,</span> <span class="n">temp_c612</span><span class="p">,</span> <span class="n">temp_rules</span><span class="p">,</span> <span class="n">format_type</span><span class="o">=</span><span class="s1">&#39;gr&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_atom_type</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;DUM&#39;</span> <span class="ow">in</span> <span class="n">atom_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">DUM_type</span> <span class="o">=</span> <span class="n">temp_atom_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_vdw</span><span class="p">(</span><span class="n">read_a_type</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__MIXEDATOMLJPAIR_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">flag</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">at1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">at2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">c6</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">c12</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">c6_14</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">c12_14</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">vdw_normal</span> <span class="o">=</span> <span class="n">vdWType</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="n">c6</span><span class="p">,</span> <span class="n">c12</span><span class="p">])</span>
            <span class="n">vdw_pair</span> <span class="o">=</span> <span class="n">PairType</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="n">c6_14</span><span class="p">,</span> <span class="n">c12_14</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_vdw</span><span class="p">(</span><span class="n">at1</span><span class="p">,</span> <span class="n">at2</span><span class="p">,</span> <span class="n">vdw_normal</span><span class="p">,</span> <span class="n">vdw_pair</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_block_interaction_type_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_interaction_type_code_v</span><span class="p">)</span>
        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">block_interaction_type_map</span><span class="p">[</span><span class="n">bl_name</span><span class="p">]</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">flag_code</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_block_interaction_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># for topology parser</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_interaction_type_code_v</span><span class="p">)</span>
        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">top_block_interaction_type_map</span><span class="p">[</span><span class="n">bl_name</span><span class="p">]</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">flag_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_interaction_type_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bonded_type</span><span class="p">,</span> <span class="n">in_f</span><span class="p">,</span> <span class="n">flag_code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_interaction_type_code_v</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">bonded_type</span><span class="p">,</span> <span class="n">in_f</span><span class="p">,</span> <span class="n">flag_code</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_interaction_type_code_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bonded_type</span><span class="p">,</span> <span class="n">in_f</span><span class="p">,</span> <span class="n">flag_code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">flag_code</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_b</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">flag_code</span><span class="p">:</span>
                <span class="n">b_code</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">temp_b</span> <span class="o">=</span> <span class="n">bonded_type</span><span class="p">(</span><span class="n">b_code</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_gr_interaction_type_container</span><span class="p">(</span><span class="n">temp_b</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_b</span><span class="o">.</span><span class="n">flag</span><span class="p">)):</span>
                <span class="n">temp_b</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_b</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">in_f</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span></div>

<span class="n">_GromosIFPBlocksParser_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_GromosIFPBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_MASSATOMTYPECODE_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__MASSATOMTYPECODE_v1&#39;</span>
<span class="n">_GromosIFPBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_SINGLEATOMLJPAIR_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__SINGLEATOMLJPAIR_v1&#39;</span>
<span class="n">_GromosIFPBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_MIXEDATOMLJPAIR_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__MIXEDATOMLJPAIR_v1&#39;</span>
<span class="n">_GromosIFPBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;__read_interaction_type_code_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__read_interaction_type_code_v1&#39;</span>
<span class="k">for</span> <span class="n">temp_bl</span> <span class="ow">in</span> <span class="n">block_interaction_type_map</span><span class="p">:</span>
    <span class="n">_GromosIFPBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">temp_bl</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_read_block_interaction_type_code&#39;</span>
<span class="n">IFPBlocksParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GromosIFPBlocksParser_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="IFPBlocksWriter"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.IFPBlocksWriter">[docs]</a><span class="k">class</span> <span class="nc">IFPBlocksWriter</span><span class="p">(</span><span class="n">GromosWriter</span><span class="p">):</span>
    <span class="c1"># writing part</span>
<div class="viewcode-block" id="IFPBlocksWriter.write_ifp"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.IFPBlocksWriter.write_ifp">[docs]</a>    <span class="k">def</span> <span class="nf">write_ifp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grs_from_fpaht</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="n">int_blocks2write</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;TITLE&#39;</span><span class="p">,</span> <span class="s1">&#39;FORCEFIELD&#39;</span><span class="p">,</span> <span class="s1">&#39;MAKETOPVERSION&#39;</span><span class="p">,</span> <span class="s1">&#39;MASSATOMTYPECODE&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDSTRETCHTYPECODE&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;BONDANGLEBENDTYPECODE&#39;</span><span class="p">,</span> <span class="s1">&#39;IMPDIHEDRALTYPECODE&#39;</span><span class="p">,</span> <span class="s1">&#39;TORSDIHEDRALTYPECODE&#39;</span><span class="p">,</span> <span class="s1">&#39;SINGLEATOMLJPAIR&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;MIXEDATOMLJPAIR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">int_blocks2write</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f_path</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_close&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span> <span class="c1"># set in defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__form_m_type</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span> <span class="c1"># set in defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__form_interactions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>  <span class="c1"># set in defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_interaction_type_v</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># set in defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__find_last_m_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">m_type</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">__write_MASSATOMTYPECODE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">):</span>
        <span class="n">m_type_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="s1">&#39;m_type&#39;</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_m_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m_type_cont</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_last_m_code</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">m_id</span><span class="p">,</span> <span class="n">m_type</span> <span class="ow">in</span> <span class="n">m_type_cont</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_m_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_type</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">m_type</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">m_type</span><span class="o">.</span><span class="n">at_id</span><span class="p">)</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__first_line_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">last_n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">last_n</span><span class="p">:</span>
            <span class="n">last_n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_interactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">last_n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_interaction_type_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bonded_type</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(</span><span class="n">bonded_type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">cont_pref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr_cont_pref</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_dict</span><span class="p">:</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_line_interaction</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_line_interaction</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">int_code</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_interactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">int_code</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">[</span><span class="n">int_code</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">)):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">temp_dict</span><span class="p">[</span><span class="n">int_code</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">temp_dict</span><span class="p">[</span><span class="n">int_code</span><span class="p">]</span><span class="o">.</span><span class="n">p_type</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_interactions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_interactions</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_interaction_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_interaction_type_v</span><span class="p">)</span>
        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">block_interaction_type_map</span><span class="p">[</span><span class="n">bl</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">temp_f</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_SINGLEATOMLJPAIR_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_rulesline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(),</span> <span class="s1">&#39;a_type&#39;</span><span class="p">):</span><span class="k">return</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">at_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span><span class="p">:</span>
            <span class="n">at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span><span class="p">[</span><span class="n">at_id</span><span class="p">]</span>
            <span class="n">temp_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">temp_s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">),</span> <span class="n">at</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">at</span><span class="o">.</span><span class="n">c612</span><span class="p">)</span>
            <span class="n">temp_s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_rulesline</span><span class="p">):</span>
                <span class="n">temp_s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_rulesline</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">temp_s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_rulesline</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">temp_s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">at</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_MIXEDATOMLJPAIR_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(),</span> <span class="s1">&#39;a_type&#39;</span><span class="p">):</span><span class="k">return</span>
        <span class="n">temp_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">temp_ff</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span>
        <span class="n">temp_ff</span><span class="o">.</span><span class="n">generate_vdw</span><span class="p">(</span><span class="n">format_type</span> <span class="o">=</span> <span class="s1">&#39;gr&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">at_p</span> <span class="ow">in</span> <span class="n">temp_ff</span><span class="o">.</span><span class="n">vdw</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">temp_ff</span><span class="o">.</span><span class="n">vdw</span><span class="p">[</span><span class="n">at_p</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span> <span class="o">+</span> <span class="n">temp_ff</span><span class="o">.</span><span class="n">vdw</span><span class="p">[</span><span class="n">at_p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span><span class="p">[</span><span class="n">at_p</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span><span class="p">[</span><span class="n">at_p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span><span class="p">[</span><span class="n">at_p</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw</span><span class="p">[</span><span class="n">at_p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span>
                <span class="n">flag_vdw_none</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flag_vdw_none</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">flag_vdw_none</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">check_if_eq</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__form_a_type</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">get_id_string</span><span class="p">(</span><span class="n">at_p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">),</span> <span class="n">get_id_string</span><span class="p">(</span><span class="n">at_p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>

<span class="n">_GromosIFPBlocksWriter_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_GromosIFPBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_MASSATOMTYPECODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_MASSATOMTYPECODE_v1&#39;</span>
<span class="n">_GromosIFPBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_interaction_type_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_interaction_type_v1&#39;</span>
<span class="k">for</span> <span class="n">temp_bl</span> <span class="ow">in</span> <span class="n">block_interaction_type_map</span><span class="p">:</span>
    <span class="n">_GromosIFPBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_&#39;</span> <span class="o">+</span> <span class="n">temp_bl</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_interaction_type&#39;</span>

<span class="n">_GromosIFPBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_SINGLEATOMLJPAIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_SINGLEATOMLJPAIR_v1&#39;</span>
<span class="n">_GromosIFPBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_MIXEDATOMLJPAIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_MIXEDATOMLJPAIR_v1&#39;</span>

<span class="n">IFPBlocksWriter</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GromosIFPBlocksWriter_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">_GromosIFPBlocksWriter_cdefs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_GromosIFPBlocksWriter_cdefs</span><span class="p">[</span><span class="s1">&#39;form_m_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;9d}{:&gt;7d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:&lt;8}{:&lt;7.4f}</span><span class="s1"> </span><span class="si">{:}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">_GromosIFPBlocksWriter_cdefs</span><span class="p">[</span><span class="s1">&#39;form_interactions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{:9d}{:8d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:&gt;4}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:16d}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:16.7e}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1">#first line, int_code, param(int), param(float)</span>
<span class="n">_GromosIFPBlocksWriter_cdefs</span><span class="p">[</span><span class="s1">&#39;form_a_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:10d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:&gt;8}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:14.5e}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:4d}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># number_of_rules_inline, number of at_types, id and name, vdw params, rules</span>
<span class="n">IFPBlocksWriter</span><span class="o">.</span><span class="n">_add_class_defaults</span><span class="p">(</span><span class="n">_GromosIFPBlocksWriter_cdefs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># MTB and topology parsing and writing</span>

<span class="c1"># helper function for BB and TOP</span>
<span class="k">def</span> <span class="nf">_parse_single_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">interaction_type</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">temp_interaction</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">temp_interaction</span><span class="o">.</span><span class="n">na</span><span class="p">):</span>
        <span class="n">temp_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">gr_id</span> <span class="o">=</span> <span class="n">temp_at</span><span class="o">.</span><span class="n">id</span>
        <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">temp_at</span><span class="p">)</span>
    <span class="n">params_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
    <span class="n">temp_int_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">temp_int_type</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">params_id</span><span class="p">,</span> <span class="n">interaction_type</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                <span class="n">cont_pref</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">_gr_cont_pref</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_int_type</span><span class="p">:</span>
            <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">temp_int_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_int_type</span><span class="p">:</span>
        <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">params_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="BBParsing"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.BBParsing">[docs]</a><span class="k">class</span> <span class="nc">BBParsing</span><span class="p">(</span><span class="n">GromosParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_atoms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_parse_bb_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">ff</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="n">n_at</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_at</span> <span class="o">=</span> <span class="n">n_at</span>
        <span class="n">n_pre_at</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_pre_at</span> <span class="o">=</span> <span class="n">n_pre_at</span>
        <span class="c1"># preatoms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pre_at</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__read_pre_atom</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>
        <span class="c1"># atoms</span>
        <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_at</span> <span class="o">-</span> <span class="n">n_pre_at</span><span class="p">):</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_atom</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">ff</span><span class="p">)</span>
        <span class="c1"># postatoms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pre_at</span><span class="p">):</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_atom</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">ff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cg</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parse_interaction</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">BondType</span><span class="p">,</span> <span class="n">ff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parse_interaction</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">AngleType</span><span class="p">,</span> <span class="n">ff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parse_interaction</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">ImproperType</span><span class="p">,</span> <span class="n">ff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parse_interaction</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">DihedralType</span><span class="p">,</span> <span class="n">ff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_exceptions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_lines</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_atoms</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__MTBUILDBLSOLUTE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">ff</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_bb_call</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">__parse_single_interaction</span> <span class="o">=</span> <span class="n">_parse_single_interaction</span>

    <span class="k">def</span> <span class="nf">__parse_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_b</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parse_single_interaction</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_pre_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">):</span>
        <span class="n">at_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="n">temp_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">at_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">gr_id</span> <span class="o">=</span> <span class="n">at_id</span>
        <span class="n">n_ex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ex</span><span class="p">):</span>
            <span class="n">temp_at_n</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">temp_at_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">temp_at_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">temp_at_e</span><span class="o">.</span><span class="n">gr_id</span> <span class="o">=</span> <span class="n">temp_at_n</span>
            <span class="n">temp_at</span><span class="o">.</span><span class="n">add_excl</span><span class="p">(</span><span class="n">temp_at_e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">at_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="n">temp_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">at_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">gr_id</span> <span class="o">=</span> <span class="n">at_id</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">a_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">m_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ff</span><span class="p">:</span>
            <span class="n">temp_true_type</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">temp_at</span><span class="o">.</span><span class="n">a_type</span><span class="p">,</span> <span class="n">AtomType</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_true_type</span><span class="p">:</span>
                <span class="n">temp_at</span><span class="o">.</span><span class="n">a_type</span> <span class="o">=</span> <span class="n">temp_true_type</span>
            <span class="n">temp_true_type</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">temp_at</span><span class="o">.</span><span class="n">m_type</span><span class="p">,</span> <span class="n">MassType</span><span class="p">,</span> <span class="n">allow_not_found</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_true_type</span><span class="p">:</span>
                <span class="n">temp_at</span><span class="o">.</span><span class="n">m_type</span> <span class="o">=</span> <span class="n">temp_true_type</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">p_ch</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">cg</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">temp_at</span><span class="p">)</span>
        <span class="n">mk_cg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">mk_cg</span> <span class="o">=</span> <span class="n">mk_cg</span>
        <span class="k">if</span> <span class="n">mk_cg</span><span class="p">:</span>
            <span class="c1">#cg = self.ChargeGroup()</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">flag_excl</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">gs</span><span class="o">.</span><span class="n">report_nl_block_split_fnc</span>
        <span class="k">if</span> <span class="n">flag_excl</span><span class="p">:</span>
            <span class="n">n_excl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_excl</span><span class="p">):</span>
                <span class="n">temp_at_n</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
                <span class="n">temp_at_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">temp_at_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">temp_at_e</span><span class="o">.</span><span class="n">gr_id</span> <span class="o">=</span> <span class="n">temp_at_n</span>
                <span class="n">temp_at</span><span class="o">.</span><span class="n">add_excl</span><span class="p">(</span><span class="n">temp_at_e</span><span class="p">)</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">flag_bb</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">temp_at</span><span class="o">.</span><span class="n">flag_excl</span> <span class="o">=</span> <span class="n">flag_excl</span>
        <span class="k">return</span> <span class="n">cg</span></div>

<span class="n">_GromosBBParsing_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_GromosBBParsing_defs</span><span class="p">[</span><span class="s1">&#39;_MTBUILDBLSOLUTE_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__MTBUILDBLSOLUTE_v1&#39;</span>
<span class="n">BBParsing</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GromosBBParsing_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="grAtomWriting"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.grAtomWriting">[docs]</a><span class="k">class</span> <span class="nc">grAtomWriting</span><span class="p">:</span>
    <span class="n">gr_id_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="s1">&#39;</span>
    <span class="n">n_atoms_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:4d}</span><span class="s1">&#39;</span>
    <span class="n">new_line_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">47</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_gr_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;gr_id&#39;</span><span class="p">):</span>
            <span class="n">gr_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;gr_id&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gr_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gr_id_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gr_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_gr_EP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_p_l</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">e_p_l</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_line_format</span>
            <span class="n">e_at</span> <span class="o">=</span> <span class="n">e_p_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">e_at</span><span class="o">.</span><span class="n">write_gr_id</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></div>


<div class="viewcode-block" id="grBBAtomWriting"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.grBBAtomWriting">[docs]</a><span class="k">class</span> <span class="nc">grBBAtomWriting</span><span class="p">(</span><span class="n">grAtomWriting</span><span class="p">):</span>
    <span class="n">gr_id_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="s1">&#39;</span>
    <span class="n">n_atoms_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:4d}</span><span class="s1">&#39;</span>
    <span class="n">new_line_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">39</span>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_excl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_l</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_gr_excl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_excl</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        n = len(self.e_l)</span>
<span class="sd">        s = &#39;{:4d}&#39;.format(n)</span>
<span class="sd">        for i, e_at in enumerate(self.e_l):</span>
<span class="sd">            if i % 6 == 0 and i != 0:</span>
<span class="sd">                s += &#39;\n&#39; + &#39; &#39; * 39</span>
<span class="sd">            s += e_at.write_gr_id</span>
<span class="sd">        return s + &#39;\n&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gr_EP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e_l</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_gr_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">temp_at</span> <span class="o">=</span> <span class="n">get_id_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_type</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">)</span>
        <span class="n">temp_mt</span> <span class="o">=</span> <span class="n">get_id_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_type</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{:&lt;4}{:&gt;5}{:&gt;5}{:11.5f}{:&gt;4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">temp_at</span><span class="p">,</span> <span class="n">temp_mt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk_cg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="grTOPAtomWriting"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.grTOPAtomWriting">[docs]</a><span class="k">class</span> <span class="nc">grTOPAtomWriting</span><span class="p">(</span><span class="n">grAtomWriting</span><span class="p">):</span>
    <span class="n">gr_id_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;6}</span><span class="s1">&#39;</span>
    <span class="n">n_atoms_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:6d}</span><span class="s1">&#39;</span>
    <span class="n">new_line_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">47</span>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gr_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__write_gr_EP</span><span class="p">(</span><span class="n">e_p_l</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">e_p_l</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:6d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">47</span>
            <span class="n">e_at</span> <span class="o">=</span> <span class="n">e_p_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">e_at</span><span class="o">.</span><span class="n">write_gr_id</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="grTOPAtomWriting.write_gr_excl"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.grTOPAtomWriting.write_gr_excl">[docs]</a>    <span class="k">def</span> <span class="nf">write_gr_excl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_l</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gr_EP</span><span class="p">(</span><span class="n">e_l</span><span class="p">)</span></div>

<div class="viewcode-block" id="grTOPAtomWriting.write_gr_pairs"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.grTOPAtomWriting.write_gr_pairs">[docs]</a>    <span class="k">def</span> <span class="nf">write_gr_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_l</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">41</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gr_EP</span><span class="p">(</span><span class="n">p_l</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_gr_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev_prop</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;at_format&#39;</span><span class="p">):</span>
            <span class="n">at_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_format</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">at_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}{:&gt;5}{:&gt;4}{:9.5f}{:9.5f}{:&gt;3d}</span><span class="s1">&#39;</span>
        <span class="n">temp_at</span> <span class="o">=</span> <span class="n">get_id_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_type</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rev_prop</span><span class="p">:</span>
            <span class="n">at_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">at_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;rev_name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">at_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">),</span> <span class="n">at_name</span><span class="p">,</span> <span class="n">temp_at</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk_cg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_rev_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_gr_prop</span><span class="p">(</span><span class="n">rev_prop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="BBWriting"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.BBWriting">[docs]</a><span class="k">class</span> <span class="nc">BBWriting</span><span class="p">(</span><span class="n">GromosWriter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__write_MTBUILDBLSOLUTE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">bb_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_bb_atoms</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:5d}{:5d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bb_atoms</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pre_at</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;# preceding exclusions</span><span class="se">\n</span><span class="s1">#ATOM                               MAE MSAE</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pre_at</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pre_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_pre_atom</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">pre_at</span><span class="o">.</span><span class="n">write_gr_id</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">29</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">pre_at</span><span class="o">.</span><span class="n">write_gr_excl</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;# atoms</span><span class="se">\n</span><span class="s1"># ATOM ANM  IACM MASS        CGMICGM MAE MSAE</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">bb_atoms</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_id</span> <span class="o">+</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_prop</span> <span class="o">+</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_excl</span>

        <span class="k">for</span> <span class="n">temp_int_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">BondType</span><span class="p">,</span> <span class="n">AngleType</span><span class="p">,</span> <span class="n">ImproperType</span><span class="p">,</span> <span class="n">DihedralType</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;# &#39;</span> <span class="o">+</span> <span class="n">temp_int_type</span><span class="o">.</span><span class="n">container2write</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">temp_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">Interaction</span><span class="p">(</span><span class="n">temp_int_type</span><span class="p">),</span> <span class="n">flag_item</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:5d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_db</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">temp_int</span> <span class="ow">in</span> <span class="n">temp_db</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">temp_int</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_id</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">temp_int</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;# LJ exceptions</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_exceptions</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">i</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;get_str&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_pre_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">at_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">at_id</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__get_bb_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bb_at</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">flag_bb</span><span class="p">:</span>
                <span class="n">bb_at</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">bb_at</span></div>

<span class="n">_GromosBBWriting_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_GromosBBWriting_defs</span><span class="p">[</span><span class="s1">&#39;_write_MTBUILDBLSOLUTE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_MTBUILDBLSOLUTE_v1&#39;</span>
<span class="n">BBWriting</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GromosBBWriting_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="MTBBlocksParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.MTBBlocksParser">[docs]</a><span class="k">class</span> <span class="nc">MTBBlocksParser</span><span class="p">(</span><span class="n">GromosParser</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__MTBUILDBLSOLUTE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BuildingBlock</span><span class="p">()</span>
        <span class="n">bb</span><span class="o">.</span><span class="n">_parse_bb_call</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="MTBBlocksParser.parse_mtb"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.MTBBlocksParser.parse_mtb">[docs]</a>    <span class="k">def</span> <span class="nf">parse_mtb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parses a mtb file and set appropriate parameters within the instance of MTB&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gr</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>



<span class="n">_GromosMTBBlocksParser_defs</span> <span class="o">=</span> <span class="p">{}</span><span class="c1"># same as _GromosBBParsing_defs</span>
<span class="n">_GromosMTBBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_MTBUILDBLSOLUTE_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__MTBUILDBLSOLUTE_v1&#39;</span>
<span class="n">MTBBlocksParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GromosMTBBlocksParser_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">### Topology</span>
<span class="n">top_block_interaction_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;BONDH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BondType</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;BOND&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BondType</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;BONDANGLEH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AngleType</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;BONDANGLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AngleType</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;IMPDIHEDRALH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImproperType</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;IMPDIHEDRAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImproperType</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;DIHEDRALH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DihedralType</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;DIHEDRAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DihedralType</span>
<span class="n">top_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;CONSTRAINT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConstraintType</span>

<span class="n">ptp_block_interaction_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">ptp_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;PERTBONDSTRETCH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BondType</span>
<span class="n">ptp_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;PERTBONDANGLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AngleType</span>
<span class="n">ptp_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;PERTIMPROPERDIH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImproperType</span>
<span class="n">ptp_block_interaction_map</span><span class="p">[</span><span class="s1">&#39;PERTPROPERDIH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DihedralType</span>


<div class="viewcode-block" id="topBlocksParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.topBlocksParser">[docs]</a><span class="k">class</span> <span class="nc">topBlocksParser</span><span class="p">(</span><span class="n">GromosParser</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_atoms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_pairs_from_p_l</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_a_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_vdw</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_a_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_residue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Residue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="topBlocksParser.parse_top_gr"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.topBlocksParser.parse_top_gr">[docs]</a>    <span class="k">def</span> <span class="nf">parse_top_gr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parses a top file (GROMOS format)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gr</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cg</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_atoms</span><span class="p">()</span></div>
        <span class="c1">#self.get_pairs_from_p_l()</span>

    <span class="k">def</span> <span class="nf">__ATOMTYPENAME_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_entries</span><span class="p">):</span>
            <span class="n">atom_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">a_type_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_a_type</span><span class="p">(</span><span class="n">a_type_id</span><span class="p">,</span> <span class="n">atom_name</span><span class="p">,</span> <span class="n">format_type</span><span class="o">=</span><span class="s1">&#39;gr&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;DUM&#39;</span> <span class="ow">in</span> <span class="n">atom_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">DUM_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_a_type</span><span class="p">(</span><span class="n">a_type_id</span><span class="p">)</span>
        <span class="n">in_f</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__RESNAME_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_entries</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_residue</span><span class="p">(</span><span class="n">res_name</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">in_f</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__SOLUTEATOM_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span> <span class="o">=</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_entries</span><span class="p">):</span>
            <span class="n">at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">at</span><span class="o">.</span><span class="n">gr_id</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">id</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Residue</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">gr_id</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">id</span>
            <span class="n">res</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
            <span class="c1">#at.res = res</span>
            <span class="n">at</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="n">at</span><span class="o">.</span><span class="n">a_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)]</span>
            <span class="n">at</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="n">at</span><span class="o">.</span><span class="n">p_ch</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="n">at</span><span class="o">.</span><span class="n">_generate_self_state</span><span class="p">()</span>
            <span class="n">cg</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
            <span class="n">mk_cg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="n">at</span><span class="o">.</span><span class="n">mk_cg</span> <span class="o">=</span> <span class="n">mk_cg</span>
            <span class="k">if</span> <span class="n">mk_cg</span><span class="p">:</span>
                <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChargeGroup</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
            <span class="n">n_excl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_excl</span><span class="p">):</span>
                <span class="n">temp_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1">#at.add_excl(temp_at)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_atom_pair2EP_l</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">temp_at</span><span class="p">)</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                temp_interaction = Interaction(ExclusionType, atoms=(at, temp_at))</span>
<span class="sd">                temp_interaction.add_state(fnc_type = &#39;gr_fnc&#39;, params = (True,))</span>
<span class="sd">                #self.add2container(temp_interaction, create=True, db_type=list)</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="c1"># exclusion pair type</span>
                <span class="n">temp_interaction</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="n">ExclusionPairType</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">temp_at</span><span class="p">))</span>
                <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">fnc_type</span> <span class="o">=</span> <span class="s1">&#39;gr_fnc&#39;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">item_id</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">((</span><span class="n">at</span><span class="p">,</span> <span class="n">temp_at</span><span class="p">)),</span> <span class="n">replace</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">n_pairs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pairs</span><span class="p">):</span>
                <span class="n">temp_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">in_f</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_container</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1">#at.add_pair(temp_at)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_atom_pair2EP_l</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">temp_at</span><span class="p">)</span>
                <span class="n">temp_interaction</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="n">ExclusionPairType</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">temp_at</span><span class="p">))</span>
                <span class="n">temp_interaction</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="n">fnc_type</span> <span class="o">=</span> <span class="s1">&#39;gr_fnc&#39;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_interaction</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">item_id</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">((</span><span class="n">at</span><span class="p">,</span> <span class="n">temp_at</span><span class="p">)),</span> <span class="n">replace</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1">#temp_atoms = (at, temp_at)</span>
                <span class="c1">#temp_state = self.find_interaction_type(temp_atoms, PairType, &#39;gr_fnc&#39;, **kwargs)</span>
        <span class="n">in_f</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="n">__parse_single_interaction</span> <span class="o">=</span> <span class="n">_parse_single_interaction</span>

    <span class="k">def</span> <span class="nf">_parse_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">top_block_interaction_map</span><span class="p">[</span><span class="n">bl_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parse_interaction</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">interaction_type</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1">#    def parse_interaction(self, parse_from, interaction, ff=None, **kwargs):</span>
<span class="c1">#        self.__parse_interaction(parse_from, interaction, ff, **kwargs)</span>

    <span class="k">def</span> <span class="nf">__parse_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_b</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parse_single_interaction</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__LJPARAMETERS_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_b</span><span class="p">):</span>
            <span class="n">at1</span><span class="p">,</span> <span class="n">at2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
            <span class="n">vdw_normal</span> <span class="o">=</span> <span class="n">vdWType</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">vdw_pair</span> <span class="o">=</span> <span class="n">PairType</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">vdw_normal</span><span class="o">.</span><span class="n">convert2se</span><span class="p">()</span>
            <span class="n">vdw_pair</span><span class="o">.</span><span class="n">convert2se</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_vdw</span><span class="p">(</span><span class="n">at1</span><span class="p">,</span> <span class="n">at2</span><span class="p">,</span> <span class="n">vdw_normal</span><span class="p">,</span> <span class="n">vdw_pair</span><span class="p">)</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__read_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">cont_name</span><span class="p">):</span>
        <span class="n">cont_name</span> <span class="o">=</span> <span class="s1">&#39;db_&#39;</span> <span class="o">+</span> <span class="n">cont_name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cont_name</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cont_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">())</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cont_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">cont</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__SOLUTEMOLECULES_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_groups</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__TEMPERATUREGROUPS_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_groups</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__PRESSUREGROUPS_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_groups</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">)</span>


<div class="viewcode-block" id="topBlocksParser.parse_dsr"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.topBlocksParser.parse_dsr">[docs]</a>    <span class="k">def</span> <span class="nf">parse_dsr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parses a top file (GROMOS format)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gr</span><span class="p">(</span><span class="n">parse_from</span><span class="p">,</span> <span class="n">parse_from_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__DISTANCERESSPEC_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="n">dish</span><span class="p">,</span> <span class="n">disc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;gr_distres_dis_const&#39;</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gr_distres_dis_const</span><span class="p">,</span> <span class="p">[</span><span class="n">dish</span><span class="p">,</span> <span class="n">disc</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gr_distres_dis_const</span> <span class="o">=</span> <span class="p">[</span><span class="n">dish</span><span class="p">,</span> <span class="n">disc</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">parse_from</span><span class="o">.</span><span class="n">block_lines</span><span class="p">():</span>
            <span class="n">temp_dr</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Distance_r</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">split_gen</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">temp_atoms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">temp_dr</span><span class="o">.</span><span class="n">gr_extra_atoms</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[]]</span>
            <span class="n">temp_dr</span><span class="o">.</span><span class="n">gr_atom_types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">temp_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">)])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">temp_at</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">temp_at</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                        <span class="n">temp_dr</span><span class="o">.</span><span class="n">gr_extra_atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp_dr</span><span class="o">.</span><span class="n">gr_extra_atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">temp_at</span><span class="p">])</span>
                <span class="n">temp_dr</span><span class="o">.</span><span class="n">gr_atom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="n">temp_dr</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="o">*</span><span class="n">temp_atoms</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">temp_dr</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
            <span class="n">temp_dr</span><span class="o">.</span><span class="n">add_state</span><span class="p">()</span>
            <span class="n">temp_dr</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span></div>

<span class="n">_topBlocksParser_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_ATOMTYPENAME_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__ATOMTYPENAME_v1&#39;</span>
<span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_RESNAME_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__RESNAME_v1&#39;</span>
<span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_SOLUTEATOM_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__SOLUTEATOM_v1&#39;</span>
<span class="k">for</span> <span class="n">temp_bl</span> <span class="ow">in</span> <span class="n">top_block_interaction_type_map</span><span class="p">:</span>
    <span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">temp_bl</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_read_block_interaction_type&#39;</span>
<span class="k">for</span> <span class="n">temp_bl</span> <span class="ow">in</span> <span class="n">top_block_interaction_map</span><span class="p">:</span>
    <span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">temp_bl</span> <span class="o">+</span> <span class="s1">&#39;_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_parse_interaction&#39;</span>
<span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_LJPARAMETERS_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__LJPARAMETERS_v1&#39;</span>
<span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_SOLUTEMOLECULES_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__SOLUTEMOLECULES_v1&#39;</span>
<span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_TEMPERATUREGROUPS_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__TEMPERATUREGROUPS_v1&#39;</span>
<span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_PRESSUREGROUPS_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__PRESSUREGROUPS_v1&#39;</span>
<span class="n">_topBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_DISTANCERESSPEC_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__DISTANCERESSPEC_v1&#39;</span>
<span class="n">topBlocksParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_topBlocksParser_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="topBlocksWriter"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.topBlocksWriter">[docs]</a><span class="k">class</span> <span class="nc">topBlocksWriter</span><span class="p">(</span><span class="n">GromosWriter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># from FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residues</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gr_cont_pref</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># from FF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_interaction_atoms_v</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_interaction_type_v</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gr_molecules_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># from Topology (GROMOS format)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_molecules</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># from Topology (GROMOS format)</span>

<div class="viewcode-block" id="topBlocksWriter.write_top_gr"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.topBlocksWriter.write_top_gr">[docs]</a>    <span class="k">def</span> <span class="nf">write_top_gr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_gr_molecule_string</span><span class="p">()</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grs_from_fpaht</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">,</span> <span class="s1">&#39;PHYSICALCONSTANTS&#39;</span><span class="p">,</span> <span class="s1">&#39;TOPVERSION&#39;</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;constraints&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">int_blocks2write</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ATOMTYPENAME&#39;</span><span class="p">,</span> <span class="s1">&#39;RESNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLUTEATOM&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDSTRETCHTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDH&#39;</span><span class="p">,</span> <span class="s1">&#39;BOND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;CONSTRAINT&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDANGLEBENDTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDANGLEH&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDANGLE&#39;</span><span class="p">,</span> <span class="s1">&#39;IMPDIHEDRALTYPE&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;IMPDIHEDRALH&#39;</span><span class="p">,</span> <span class="s1">&#39;IMPDIHEDRAL&#39;</span><span class="p">,</span> <span class="s1">&#39;TORSDIHEDRALTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DIHEDRALH&#39;</span><span class="p">,</span> <span class="s1">&#39;DIHEDRAL&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;LJPARAMETERS&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLUTEMOLECULES&#39;</span><span class="p">,</span> <span class="s1">&#39;TEMPERATUREGROUPS&#39;</span><span class="p">,</span> <span class="s1">&#39;PRESSUREGROUPS&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;LJEXCEPTIONS&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLVENTATOM&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLVENTCONSTR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">int_blocks2write</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ATOMTYPENAME&#39;</span><span class="p">,</span> <span class="s1">&#39;RESNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLUTEATOM&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDSTRETCHTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDH&#39;</span><span class="p">,</span> <span class="s1">&#39;BOND&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;BONDANGLEBENDTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDANGLEH&#39;</span><span class="p">,</span> <span class="s1">&#39;BONDANGLE&#39;</span><span class="p">,</span> <span class="s1">&#39;IMPDIHEDRALTYPE&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;IMPDIHEDRALH&#39;</span><span class="p">,</span> <span class="s1">&#39;IMPDIHEDRAL&#39;</span><span class="p">,</span> <span class="s1">&#39;TORSDIHEDRALTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DIHEDRALH&#39;</span><span class="p">,</span> <span class="s1">&#39;DIHEDRAL&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;LJPARAMETERS&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLUTEMOLECULES&#39;</span><span class="p">,</span> <span class="s1">&#39;TEMPERATUREGROUPS&#39;</span><span class="p">,</span> <span class="s1">&#39;PRESSUREGROUPS&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;LJEXCEPTIONS&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLVENTATOM&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLVENTCONSTR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">int_blocks2write</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f_path</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_close&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<span class="c1"># missing CROSSDIHEDRALH, CROSSDIHEDRAL</span>

<div class="viewcode-block" id="topBlocksWriter.write_ptp"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.topBlocksWriter.write_ptp">[docs]</a>    <span class="k">def</span> <span class="nf">write_ptp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_gr_molecule_string</span><span class="p">()</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="n">GromosFile</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">temp_f</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">)</span>
        <span class="n">int_blocks2write</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;PERTATOMPARAM&#39;</span><span class="p">,</span> <span class="s1">&#39;PERTATOMPAIR&#39;</span><span class="p">,</span> <span class="s1">&#39;PERTBONDSTRETCH&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;PERTBONDANGLE&#39;</span><span class="p">,</span> <span class="s1">&#39;PERTIMPROPERDIH&#39;</span><span class="p">,</span> <span class="s1">&#39;PERTPROPERDIH&#39;</span><span class="p">)</span>
        <span class="n">top_state</span><span class="p">,</span> <span class="n">other_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_top_other_state</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">top_other_state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">top_state</span><span class="o">=</span><span class="n">top_state</span><span class="p">,</span> <span class="n">other_state</span><span class="o">=</span><span class="n">other_state</span><span class="p">)</span>
        <span class="n">write_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">write_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">top_other_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">temp_f</span><span class="p">,</span> <span class="o">*</span><span class="n">int_blocks2write</span><span class="p">,</span> <span class="o">**</span><span class="n">write_kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="topBlocksWriter.write_rev_ptp_top_names"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.topBlocksWriter.write_rev_ptp_top_names">[docs]</a>    <span class="k">def</span> <span class="nf">write_rev_ptp_top_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_top_gr</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">rev_top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__write_ATOMTYPENAME_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">a_type</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_RESNAME_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rev_top&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">rev_res_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="n">res</span><span class="p">],</span> <span class="s1">&#39;rev_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rev_res_name</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="n">rev_res_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="n">res</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="n">res</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_SOLUTEATOM_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">e_l</span><span class="p">,</span> <span class="n">p_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_atom_excl_pair_list</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">():</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_id</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rev_top&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_rev_prop</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_prop</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_excl</span><span class="p">(</span><span class="n">e_l</span><span class="p">[</span><span class="n">at</span><span class="p">])</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_pairs</span><span class="p">(</span><span class="n">p_l</span><span class="p">[</span><span class="n">at</span><span class="p">])</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_interaction_type_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bonded_type</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">(</span><span class="n">bonded_type</span><span class="p">,</span> <span class="n">cont_pref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr_cont_pref</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_dict</span><span class="p">:</span>
            <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">int_code</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">[</span><span class="n">int_code</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">)):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">temp_dict</span><span class="p">[</span><span class="n">int_code</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">temp_dict</span><span class="p">[</span><span class="n">int_code</span><span class="p">]</span><span class="o">.</span><span class="n">p_type</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:4d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:16.7e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_interaction_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_interaction_type_v</span><span class="p">)</span>
        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">top_block_interaction_type_map</span><span class="p">[</span><span class="n">bl</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">temp_f</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_interaction_atoms_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bonded_container</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bonded_container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">top_state</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;top_state&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;top_state&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bonded_container</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bonded_container</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_id</span>
            <span class="n">state4writing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state</span><span class="p">(</span><span class="n">bond</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            if hasattr(bond, &#39;state&#39;):</span>
<span class="sd">                state4writing = bond.state</span>
<span class="sd">            else:</span>
<span class="sd">                state4writing = self.get_state(bond.states, **kwargs)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            if state4writing is None:</span>
<span class="sd">                raise Exception(&#39;all interaction states None: &#39; + str(bond.int_type) + &#39;\natoms: &#39; + str(bond.atoms))</span>
<span class="sd">            if top_state == &#39;any_non_none&#39;:</span>
<span class="sd">                flag_state_not_found = True</span>
<span class="sd">                for temp_state in bond.states:</span>
<span class="sd">                    if temp_state is not None:</span>
<span class="sd">                        s += &#39;{:&gt;5}\n&#39;.format(get_id_string(temp_state))</span>
<span class="sd">                        flag_state_not_found = False</span>
<span class="sd">                        break</span>
<span class="sd">                if flag_state_not_found:</span>
<span class="sd">                    raise Exception(&#39;all interaction states None: &#39; + str(bond.int_type) + &#39;\natoms: &#39; + str(bond.atoms))</span>
<span class="sd">            else:</span>
<span class="sd">                s += &#39;{:&gt;5}\n&#39;.format(get_id_string(bond.states[top_state]))</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">state4writing</span><span class="p">))</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_interaction_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_interaction_atoms_v</span><span class="p">)</span>
        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">top_block_interaction_map</span><span class="p">[</span><span class="n">bl</span><span class="p">]</span>
        <span class="n">bonded_container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">,</span> <span class="n">flag_class</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_f</span><span class="p">(</span><span class="n">bonded_container</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_empty_interaction_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_LJPARAMETERS_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">vdw</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">at_p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">vdw</span><span class="p">:</span>
            <span class="n">vdw_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span><span class="o">.</span><span class="n">vdw</span><span class="p">[</span><span class="n">at_p</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}{:&gt;5}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">at_p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">),</span> <span class="n">get_id_string</span><span class="p">(</span><span class="n">at_p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">))</span>
            <span class="n">temp_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:14.6e}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">vdw_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pair_p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pair_p</span> <span class="o">=</span>  <span class="n">vdw_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">c612</span>
<span class="c1">#            s += temp_str.format(vdw_p[0].p[1], vdw_p[0].p[0], vdw_p[1].p[1], vdw_p[1].p[0])</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">temp_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vdw_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">c612</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vdw_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">c612</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair_p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pair_p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_mol_string_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr_molecules_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_gr_molecule_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_molecules</span><span class="p">(</span><span class="n">flag_mol_atom_sort</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mols</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">{:&gt;5}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gr_molecules_string</span> <span class="o">=</span> <span class="n">s</span>

<span class="c1"># ptp writing</span>
    <span class="k">def</span> <span class="nf">__write_PERTATOMPARAM_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">DUM_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_DUM_type</span>
        <span class="n">ALJ</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ALJ&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ACRF</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ACRF&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1">#top_state, other_state = self._get_top_other_state(**kwargs)</span>
        <span class="n">a_type_kwargs</span><span class="p">,</span> <span class="n">m_kwargs</span><span class="p">,</span> <span class="n">pch_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_atom_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">N_at_ptp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">():</span>
            <span class="n">a_type_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">a_type_kwargs</span><span class="p">)</span>
            <span class="n">m_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">m_kwargs</span><span class="p">)</span>
            <span class="n">p_ch_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">pch_kwargs</span><span class="p">)</span>
            <span class="n">a_type_ptp</span><span class="p">,</span> <span class="n">m_ptp</span><span class="p">,</span> <span class="n">p_ch_ptp</span><span class="p">,</span> <span class="n">flag_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_ptp_states</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">a_type_ptp</span><span class="p">,</span> <span class="n">m_ptp</span><span class="p">,</span> <span class="n">p_ch_ptp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flag_ptp</span><span class="p">:</span>
                <span class="n">N_at_ptp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_id</span>
                <span class="n">at_prop</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">res</span><span class="p">,</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">),</span> <span class="n">at</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="n">ptp_prop</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">at_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">a_type_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">))</span>
                <span class="n">ptp_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">a_type_ptp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">))</span>
                <span class="n">at_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ptp_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_ptp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">at_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_ch_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ptp_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_ch_ptp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># get the text</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}{:&gt;6}{:&gt;4}{:11.5f}{:11.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">at_prop</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;4}{:11.5f}{:11.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ptp_prop</span><span class="p">)</span>
                <span class="c1"># get the softness</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_soft_heawy&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> \
                        <span class="p">(</span><span class="n">m_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.5</span> <span class="ow">and</span> <span class="n">m_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.5</span> <span class="ow">and</span> <span class="n">a_type_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">DUM_type</span> <span class="ow">and</span> <span class="n">a_type_ptp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">DUM_type</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:9d}{:9d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:9.2f}{:9.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ALJ</span><span class="p">,</span> <span class="n">ACRF</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">N_at_ptp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">s</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_PERTATOMPAIR_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">N_excl_pair_ptp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">at_p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excl_pair</span><span class="p">:</span>
            <span class="n">excl_pair_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excl_pair</span><span class="p">[</span><span class="n">at_p</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">excl_pair_ptp</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">at_p</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_id</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">excl_pair_ptp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_code_map</span><span class="p">[</span><span class="n">excl_pair_ptp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">N_excl_pair_ptp</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">N_excl_pair_ptp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">s</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_pert_interaction_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bonded_container</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bonded_container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">N_int_ptp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">temp_int</span> <span class="ow">in</span> <span class="n">bonded_container</span><span class="p">:</span>
            <span class="n">temp_int_ptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ptp_states</span><span class="p">(</span><span class="n">temp_int</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_int_ptp</span><span class="p">:</span>
                <span class="n">N_int_ptp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">temp_int</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_id</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">temp_int_ptp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">N_int_ptp</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">N_int_ptp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_pert_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_pert_interaction_v</span><span class="p">)</span>
        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">ptp_block_interaction_map</span><span class="p">[</span><span class="n">bl</span><span class="p">]</span>
        <span class="n">bonded_container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">,</span> <span class="n">flag_class</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">allow_not_found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">temp_f</span><span class="p">(</span><span class="n">bonded_container</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_PERTBONDSTRETCH_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pert_interaction</span><span class="p">(</span><span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_PERTBONDANGLE_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pert_interaction</span><span class="p">(</span><span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_PERTIMPROPERDIH_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pert_interaction</span><span class="p">(</span><span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_PERTPROPERDIH_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pert_interaction</span><span class="p">(</span><span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="n">_topBlocksWriter_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_ATOMTYPENAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_ATOMTYPENAME_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_RESNAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_RESNAME_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_SOLUTEATOM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_SOLUTEATOM_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_interaction_type_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_interaction_type_v1&#39;</span>

<span class="k">for</span> <span class="n">temp_bl</span> <span class="ow">in</span> <span class="n">top_block_interaction_type_map</span><span class="p">:</span>
    <span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_&#39;</span> <span class="o">+</span> <span class="n">temp_bl</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_write_interaction_type&#39;</span>

<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_SINGLEATOMLJPAIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_SINGLEATOMLJPAIR_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_MIXEDATOMLJPAIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_MIXEDATOMLJPAIR_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_interaction_atoms_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_interaction_atoms_v1&#39;</span>

<span class="k">for</span> <span class="n">temp_bl</span> <span class="ow">in</span> <span class="n">top_block_interaction_map</span><span class="p">:</span>
    <span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_&#39;</span> <span class="o">+</span> <span class="n">temp_bl</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_write_interaction_atoms&#39;</span>

<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_BONDH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_empty_interaction_atoms&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_BONDANGLEH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_empty_interaction_atoms&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_IMPDIHEDRALH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_empty_interaction_atoms&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_DIHEDRALH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_empty_interaction_atoms&#39;</span>

<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_LJPARAMETERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_LJPARAMETERS_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_SOLUTEMOLECULES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_mol_string_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_TEMPERATUREGROUPS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_mol_string_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_PRESSUREGROUPS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_mol_string_v1&#39;</span>

<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;__write_pert_interaction_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_pert_interaction_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_PERTATOMPARAM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_PERTATOMPARAM_v1&#39;</span>
<span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_PERTATOMPAIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_PERTATOMPAIR_v1&#39;</span>

<span class="k">for</span> <span class="n">temp_bl</span> <span class="ow">in</span> <span class="n">ptp_block_interaction_map</span><span class="p">:</span>
    <span class="n">_topBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_&#39;</span> <span class="o">+</span>  <span class="n">temp_bl</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_write_pert_interaction&#39;</span>

<span class="n">topBlocksWriter</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_topBlocksWriter_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="c1"># PTP / EDS reading and writing</span>
<div class="viewcode-block" id="PTP_EDS_BlocksParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.PTP_EDS_BlocksParser">[docs]</a><span class="k">class</span> <span class="nc">PTP_EDS_BlocksParser</span><span class="p">(</span><span class="n">GromosParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__MPERTATOM_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intDB</span><span class="p">()</span>
        <span class="n">N_EDS_atoms</span><span class="p">,</span> <span class="n">N_states</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_states</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_EDS_atoms</span><span class="p">):</span>
            <span class="n">at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)]</span>
            <span class="n">at_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">at</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">at_name</span>
            <span class="n">at</span><span class="o">.</span><span class="n">m_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">at</span><span class="o">.</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">N_states</span>
            <span class="n">at</span><span class="o">.</span><span class="n">p_ch_states</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">N_states</span>
            <span class="n">at</span><span class="o">.</span><span class="n">a_type_states</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">N_states</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_states</span><span class="p">):</span>
                <span class="n">at</span><span class="o">.</span><span class="n">a_type_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">a_type</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)]</span>
                <span class="n">at</span><span class="o">.</span><span class="n">p_ch_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
            <span class="n">at</span><span class="o">.</span><span class="n">soft_core</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__write_MPERTATOM_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">DUM_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_DUM_type</span>
        <span class="n">ALJ</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ALJ&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ACRF</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ACRF&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">N_at_ptp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">ND_a_type_states</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">ND_pch_states</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">N_at_ptp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">N_states</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">p_ch_states</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">at</span><span class="o">.</span><span class="n">write_gr_id</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&gt;6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_states</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;4}{:11.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_id_string</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">a_type_states</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">flag_id</span><span class="o">=</span><span class="s1">&#39;gr_id&#39;</span><span class="p">),</span> <span class="n">at</span><span class="o">.</span><span class="n">p_ch_states</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:9.2f}{:9.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ALJ</span><span class="p">,</span> <span class="n">ACRF</span><span class="p">)</span>
        <span class="n">state_names</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state_names&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_names</span><span class="p">)</span><span class="o">!=</span><span class="n">N_states</span><span class="p">:</span>
            <span class="n">state_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;st_</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_states</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">states_line</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&gt;15}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">N_states</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}{:&gt;5}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N_at_ptp</span><span class="p">,</span> <span class="n">N_states</span><span class="p">)</span> <span class="o">+</span> <span class="n">states_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">state_names</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<div class="viewcode-block" id="PTP_EDS_BlocksParser.write_EDS"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.PTP_EDS_BlocksParser.write_EDS">[docs]</a>    <span class="k">def</span> <span class="nf">write_EDS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">temp_f</span> <span class="o">=</span> <span class="n">GromosFile</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">temp_f</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">)</span>
        <span class="n">int_blocks2write</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;MPERTATOM&#39;</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">temp_f</span><span class="p">,</span> <span class="o">*</span><span class="n">int_blocks2write</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<span class="n">_PTP_EDS_BlocksParser_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_PTP_EDS_BlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_MPERTATOM_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__MPERTATOM_v1&#39;</span>
<span class="n">_PTP_EDS_BlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_write_MPERTATOM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_MPERTATOM_v1&#39;</span>

<span class="n">PTP_EDS_BlocksParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_PTP_EDS_BlocksParser_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1">## CNF reading and writing</span>
<div class="viewcode-block" id="cnfBlocksParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.cnfBlocksParser">[docs]</a><span class="k">class</span> <span class="nc">cnfBlocksParser</span><span class="p">(</span><span class="n">GromosParser</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__TIMESTEP_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_step</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)))</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_pos_vel</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">24</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">15</span><span class="p">:</span><span class="mi">39</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">15</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">temp</span>

    <span class="k">def</span> <span class="nf">__POSITION_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parse_from</span><span class="o">.</span><span class="n">block_lines</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
                <span class="n">at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Atom</span><span class="p">()</span>
                <span class="n">at</span><span class="o">.</span><span class="n">res_id</span> <span class="o">=</span> <span class="n">i</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">at</span><span class="o">.</span><span class="n">res_name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">at</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">at</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">at</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">at</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pos_vel</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add2container</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">db_type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__LATTICESHIFTS_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="n">at</span><span class="o">.</span><span class="n">latshift</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">at</span><span class="o">.</span><span class="n">latshift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__VELOCITY_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parse_from</span><span class="o">.</span><span class="n">block_lines</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
                <span class="n">at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                <span class="n">at</span><span class="o">.</span><span class="n">vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pos_vel</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__GENBOX_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Box</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">box_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">abc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">euler_angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span></div>

<span class="n">_cnfBlocksParser_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_cnfBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_TIMESTEP_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__TIMESTEP_v1&#39;</span>
<span class="n">_cnfBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_POSITION_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__POSITION_v1&#39;</span>
<span class="n">_cnfBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_LATTICESHIFTS_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__LATTICESHIFTS_v1&#39;</span>
<span class="n">_cnfBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_VELOCITY_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__VELOCITY_v1&#39;</span>
<span class="n">_cnfBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_GENBOX_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__GENBOX_v1&#39;</span>
<span class="n">cnfBlocksParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_cnfBlocksParser_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="cnfBlocksWriter"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.cnfBlocksWriter">[docs]</a><span class="k">class</span> <span class="nc">cnfBlocksWriter</span><span class="p">(</span><span class="n">GromosWriter</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_pos_str</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="s1"> </span><span class="si">{:&lt;5}</span><span class="s1"> </span><span class="si">{:&lt;6}{:&gt;6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">res_id</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">res_name</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:15.9f}{:15.9f}{:15.9f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">at</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_vel_str</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="s1"> </span><span class="si">{:&lt;5}</span><span class="s1"> </span><span class="si">{:&lt;6}{:&gt;6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">res_id</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">res_name</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:15.9f}{:15.9f}{:15.9f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">at</span><span class="o">.</span><span class="n">vel</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:15.9f}{:15.9f}{:15.9f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">__write_TIMESTEP_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:15d}{:15.9f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_step</span><span class="p">)</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_POSITION_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pos_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__write_VELOCITY_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vel_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__write_POSRESSPEC_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">at2use</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;at2use&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">at2use</span><span class="p">:</span>
            <span class="n">at2discard</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;at2discard&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">at</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">at2discard</span><span class="p">:</span>
                    <span class="n">at2use</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">at2use</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">at2use_cnf</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">at2use</span><span class="p">:</span>
                    <span class="n">at2use_cnf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at</span><span class="p">])</span>
                <span class="n">at2use</span> <span class="o">=</span> <span class="n">at2use_cnf</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pos_str</span><span class="p">(</span><span class="n">at2use</span><span class="p">)</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_REFPOSITION_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pos_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__write_GENBOX_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">box_type</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:15.9f}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">attribs_2_write</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;angles&#39;</span><span class="p">,</span> <span class="s1">&#39;euler_angles&#39;</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attrib_2_write</span> <span class="ow">in</span> <span class="n">attribs_2_write</span><span class="p">:</span>
            <span class="n">temp_values</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="p">,</span> <span class="n">attrib_2_write</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">temp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">temp_values</span><span class="p">)</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>

<span class="n">_cnfBlocksWriter_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_cnfBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_POSITION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_POSITION_v1&#39;</span>
<span class="n">_cnfBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_VELOCITY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_VELOCITY_v1&#39;</span>
<span class="n">_cnfBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_TIMESTEP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_TIMESTEP_v1&#39;</span>
<span class="n">_cnfBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_POSRESSPEC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_POSRESSPEC_v1&#39;</span>
<span class="n">_cnfBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_REFPOSITION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_REFPOSITION_v1&#39;</span>
<span class="n">_cnfBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_GENBOX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_GENBOX_v1&#39;</span>

<span class="n">cnfBlocksWriter</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_cnfBlocksWriter_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="c1">#### CNF TRJ reading and writing</span>

<div class="viewcode-block" id="TrjCnfBlocksParser"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.TrjCnfBlocksParser">[docs]</a><span class="k">class</span> <span class="nc">TrjCnfBlocksParser</span><span class="p">(</span><span class="n">GromosParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;parser for cnf trajectories&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_num_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_num_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_frame_dtype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gr_add_frame</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_pos_vel</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">real_num_dtype</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">real_num_dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">split_gen</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">return</span> <span class="n">temp</span>

    <span class="k">def</span> <span class="nf">__TIMESTEP_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_num_dtype</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_real_num_dtype</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__POSITIONRED_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">frame_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">parse_from</span><span class="o">.</span><span class="n">block_lines</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frame_coord</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_num_dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_atoms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_coord</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_frame_dtype</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__GENBOX_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from</span><span class="p">,</span> <span class="n">bl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">))</span>
        <span class="n">temp_box</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_num_dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">temp_box</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">parse_from</span><span class="o">.</span><span class="n">block_split_fnc</span><span class="p">)</span>
        <span class="n">parse_from</span><span class="o">.</span><span class="n">end_block_split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">temp_box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gr_add_frame</span><span class="p">()</span></div>

<span class="n">_TrjCnfBlocksParser_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_TrjCnfBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_TIMESTEP_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__TIMESTEP_v1&#39;</span>
<span class="n">_TrjCnfBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_POSITIONRED_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__POSITIONRED_v1&#39;</span>
<span class="n">_TrjCnfBlocksParser_defs</span><span class="p">[</span><span class="s1">&#39;_GENBOX_parser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__GENBOX_v1&#39;</span>
<span class="n">TrjCnfBlocksParser</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_TrjCnfBlocksParser_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="GeneralCnfWriter"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.GeneralCnfWriter">[docs]</a><span class="k">class</span> <span class="nc">GeneralCnfWriter</span><span class="p">(</span><span class="n">GromosWriter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_real_num_format</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_real_num_format</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_real_num_v</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__write_real_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">real_num_format</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">num</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">txt_format</span> <span class="o">=</span> <span class="p">(</span><span class="n">real_num_format</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">txt_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">num</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txt_format</span> <span class="o">=</span> <span class="n">real_num_format</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">txt_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">real_num_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_real_num_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_real_num</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real_num_format</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_real_num_v2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__write_real_num</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="s1">&#39; </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_atom_pos_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_coord</span><span class="p">):</span>
        <span class="n">fnc2write</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_GeneralCnfWriter__write_real_num_v&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_real_num_v</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fnc2write</span><span class="p">(</span><span class="n">atom_coord</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__write_TIMESTEP_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{:15d}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_real_num_format</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__write_GENBOX_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;5}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="s1">&#39;box_type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">fnc2write</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_GeneralCnfWriter__write_real_num_v&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_real_num_v</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">fnc2write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>

<span class="n">_GeneralCnfWriter_defs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_real_num_format&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">{:15.9f}</span><span class="s1">&#39;</span><span class="p">}</span>
<span class="n">_GeneralCnfWriter_defs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_time_real_num_format&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">{:15.9f}</span><span class="s1">&#39;</span><span class="p">}</span>
<span class="n">_GeneralCnfWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_TIMESTEP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_TIMESTEP_v1&#39;</span>
<span class="n">_GeneralCnfWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_GENBOX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_GENBOX_v1&#39;</span>
<span class="n">_GeneralCnfWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_real_num_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">GeneralCnfWriter</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_GeneralCnfWriter_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="TrjCnfBlocksWriter"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.TrjCnfBlocksWriter">[docs]</a><span class="k">class</span> <span class="nc">TrjCnfBlocksWriter</span><span class="p">(</span><span class="n">GeneralCnfWriter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__just_for_readability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trj</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="TrjCnfBlocksWriter.write_trc_npz"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.TrjCnfBlocksWriter.write_trc_npz">[docs]</a>    <span class="k">def</span> <span class="nf">write_trc_npz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.trc.npz&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;trc&#39;</span><span class="p">):</span>
                <span class="n">f_path</span> <span class="o">+=</span> <span class="s1">&#39;.npz&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f_path</span> <span class="o">+=</span> <span class="s1">&#39;.trc.npz&#39;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_title</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lines</span><span class="p">),</span> <span class="n">trj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__write_POSITIONRED_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gf</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">at_coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="p">[</span><span class="s1">&#39;coord&#39;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_atom_pos_str</span><span class="p">(</span><span class="n">at_coord</span><span class="p">)</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">write_block</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<div class="viewcode-block" id="TrjCnfBlocksWriter.write_trc"><a class="viewcode-back" href="../../../../../SMArt.md.gromos.io.html#SMArt.md.gromos.io.incl.TrjCnfBlocksWriter.write_trc">[docs]</a>    <span class="k">def</span> <span class="nf">write_trc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grs_from_fpaht</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">)</span>
        <span class="n">int_blocks2write</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;TIMESTEP&#39;</span><span class="p">,</span> <span class="s1">&#39;POSITIONRED&#39;</span><span class="p">,</span> <span class="s1">&#39;GENBOX&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fr</span> <span class="o">=</span> <span class="n">fr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_gromos_format</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="o">*</span><span class="n">int_blocks2write</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f_path</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flag_close&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<span class="n">_TrjCnfBlocksWriter_defs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_TrjCnfBlocksWriter_defs</span><span class="p">[</span><span class="s1">&#39;_write_POSITIONRED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__write_POSITIONRED_v1&#39;</span>

<span class="n">TrjCnfBlocksWriter</span><span class="o">.</span><span class="n">_add_defaults</span><span class="p">(</span><span class="n">_TrjCnfBlocksWriter_defs</span><span class="p">,</span> <span class="n">flag_set</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Drazen Petrov.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>